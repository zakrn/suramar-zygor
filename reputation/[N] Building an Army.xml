<HBProfile xsi:noNamespaceSchemaLocation="../Schemas/EchoSchema.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Name>[N] Building an Army</Name>
    <MinDurability>0.3</MinDurability>
    <MinFreeBagSlots>3</MinFreeBagSlots>
    <SellGrey>true</SellGrey>
    <SellWhite>false</SellWhite>
    <SellGreen>false</SellGreen>
    <SellBlue>false</SellBlue>
    <SellPurple>false</SellPurple>
    <MailGrey>false</MailGrey>
    <MailWhite>true</MailWhite>
    <MailGreen>true</MailGreen>
    <MailBlue>true</MailBlue>
    <MailPurple>true</MailPurple>
    <TargetElites>true</TargetElites>
    <!--These aren't used often, only if there are navigation issues with the profile or areas you want the character to avoid-->
    <Blackspots>
    </Blackspots>
    <!--These are the vendors you want the bot to go to when doing a repair or vendor run-->
    <Vendors>
    </Vendors>
    <!--These are the locations of the available mailboxes that you want your character to use-->
    <Mailboxes>
    </Mailboxes>
    <!--Setting these would make sure the character stays away from and does not attack these mobs-->
    <AvoidMobs>
    </AvoidMobs>
    <!--Here is where the meat of the profile will take place-->
    <QuestOrder>
        <CustomBehavior File="RunCode" Type="Definition">
            <![CDATA[

                    bool DoQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (HasQuest(questId) && !IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }
                    bool NeedsQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (!HasQuest(questId) && !IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }
                    bool NeedsBreadcrumbQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (IsQuestCompleted(questId)) return false;
                        }
                        return true;
                    }
                    bool QuestDone(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (HasQuest(questId) && IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }

                    bool HasAncientMana( uint amount )
                    {
                        return WoWCurrency.GetCurrencyById(1155) != null && WoWCurrency.GetCurrencyById(1155).Amount >= amount;
                    }

                    uint MaxAncientMana()
                    {
                        if( WoWCurrency.GetCurrencyById(1155) != null )
                        {
                            return WoWCurrency.GetCurrencyById(1155).TotalMax;
                        }
                        return 0;
                    }

                    double CalcDist( Vector2 v1, Vector2 v2 )
                    {
                        double dx = v2.X - v1.X;
                        double dy =  v2.Y - v1.Y;
                        double r = Math.Pow( dx , 2) - Math.Pow( dy, 2);

                        if( r < 0 )
                            r *= -1;

                        return Math.Sqrt(  r );
                    }

                    bool IsThirsty( uint friendId )
                    {
                        List<string> values = Lua.GetReturnValues("return GetFriendshipReputation(" + friendId +")");

                        if( values.Count == 0 )
                        {   
                            Logging.Write(System.Windows.Media.Colors.Red, "[Zak]: Failed to get arcane thirst");
                            return false;
                        }

                        int level = Int32.Parse( values[1]);
                        int threshold = Int32.Parse( values[7]);
                        int newlevel = level - threshold;

                        return newlevel <= 1;
                    }

                    bool IsThalyssraThirsty()
                    {
                        return IsThirsty(1860);
                    }

                    bool IsOculethThirsty()
                    {
                        return IsThirsty(1862);
                    }

                    bool IsValtroisThirsty()
                    {
                        return IsThirsty(1919);
                    }

                    void PrintStep( uint step )
                    {
                        Logging.Write(System.Windows.Media.Colors.Yellow, "[Zak]: " + step);
                    }

                    void Print( string msg )
                    {
                        Logging.Write(System.Windows.Media.Colors.DeepSkyBlue, "[Zak]: " + msg);
                    }

                    int StageNumber() {
                        return Bots.DungeonBuddy.Helpers.ScenarioInfo.Current.CurrentStageNumber;
                    }

                    WoWUnit NearestBuddy()
                    {
                        return ObjectManager.GetObjectsOfType<WoWUnit>()
                            .OrderBy(ret => ret.Distance)
                            .FirstOrDefault(target =>
                                target.Distance <= 30 &&
                                target.IsAlive &&
                                (int)target.FactionId == 1665 &&
                                (int)target.Entry == 110141 );
                    }

                    bool IsObjectNearby( uint objId )
                    {
                        return ObjectManager.GetObjectsOfType<WoWGameObject>()
                            .OrderBy(ret => ret.Distance)
                            .FirstOrDefault(target =>
                                target.Distance <= 100 &&
                                (int)target.Entry == objId ) != null;
                    }

                    bool IsNearBuddy() 
                    {
                        return NearestBuddy() != null;
                    }

                    bool FetchBuddy()
                    {
                        WoWUnit obj = NearestBuddy();
                        if( obj != null)
                        {
                            Navigator.MoveTo(obj.Location);
                            obj.Interact();
                            return true;
                        }
                        return false;
                    }

                ]]>
        </CustomBehavior>
        <CustomBehavior File="RunCode" Code="Logging.Write(System.Windows.Media.Colors.Yellow, &quot;[Zak]: ZoneId: &quot; + Me.AreaId);" />
        <CustomBehavior File="RunCode" Code="Logging.Write(System.Windows.Media.Colors.Yellow, &quot;[Zak]: StageNumber: &quot; + Bots.DungeonBuddy.Helpers.ScenarioInfo.Current.CurrentStageNumber );" />
        <If Condition="Bots.DungeonBuddy.Helpers.ScenarioInfo.Current != null">
            <!-- turn in first time quest if we have it -->
            <If Condition="HasQuest(44636)">
                <TurnIn Nav="Fly" QuestName="Building an Army" QuestId="44636" />
            </If>
            <!-- TRAINING SCENARIO -->
            <If Condition="StageNumber() == 1">
                <CustomBehavior File="InteractWith" MobIds="109008" NumOfTimes="1" InteractByGossipOptions="1" X="2102.989" Y="5392.836" Z="48.12273" />
            </If>
            <While Condition="StageNumber() == 2">
                <CustomBehavior File="RunCode" Code="Print(&quot;A&quot;)" />
                <MoveTo X="2199.796" Y="5400.14" Z="36.8759" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;B&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="2206" Y="5398.055" Z="36.87733" />
                    </HuntingGrounds>
                </CustomBehavior>
                <MoveTo X="2219.827" Y="5360.882" Z="36.87654" />
                <MoveTo X="2190.537" Y="5338.958" Z="36.87654" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;B&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="2200.619" Y="5339.696" Z="36.87654" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- go down the stairs -->
                <CustomBehavior File="RunCode" Code="Print(&quot;C&quot;)" />
                <MoveTo X="2253.811" Y="5351.977" Z="37.02298" />
                <MoveTo X="2287.91" Y="5431.884" Z="15.18522" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;D&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="2286.895" Y="5429.94" Z="15.12867" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;D-2&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="2272.417" Y="5457.187" Z="9.422404" />
                <!-- get 25% health treasure -->
                <CustomBehavior File="RunCode" Code="Print(&quot;E&quot;)" />
                <If Condition="!IsQuestCompleted(43149)">
                    <CustomBehavior File="InteractWith" MobIds="251728" NumOfTimes="1" InteractByGossipOptions="1" CollectionDistance="20" WaitForNpcs="false">
                        <HuntingGrounds>
                            <Hotspot X="2247.089" Y="5519.042" Z="1.641239" />
                        </HuntingGrounds>
                    </CustomBehavior>
                </If>
                <!-- clear area -->
                <CustomBehavior File="RunCode" Code="Print(&quot;F&quot;)" />
                <MoveTo X="2239.739" Y="5521.931" Z="1.641034" />
                <MoveTo X="2195.144" Y="5528.069" Z="1.641239" />
                <!-- grab chest if we need it -->
                <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="2184.927" Y="5539.891" Z="1.640897" />
                <MoveTo X="2168.956" Y="5487.047" Z="1.652718" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;G&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="2182.205" Y="5483.355" Z="1.592948" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- continue clearing -->
                <CustomBehavior File="RunCode" Code="Print(&quot;H&quot;)" />
                <MoveTo X="2157.548" Y="5433.917" Z="1.641177" />
                <MoveTo X="2201.579" Y="5422.103" Z="1.640879" />
                <!-- grab chest if we need it -->
                <CustomBehavior File="RunCode" Code="Print(&quot;AD&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="2204.557" Y="5427.115" Z="1.65529" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;I&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="2157.553" Y="5426.494" Z="1.640805" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- grab chest if we need it -->
                <CustomBehavior File="RunCode" Code="Print(&quot;J&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="2206.876" Y="5474.39" Z="1.593738" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- go downstairs -->
                <CustomBehavior File="RunCode" Code="Print(&quot;K&quot;)" />
                <MoveTo X="2179.963" Y="5467.543" Z="-24.81754" />
                <!-- get big chest under stairs -->
                <CustomBehavior File="RunCode" Code="Print(&quot;AE&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251665" NumOfTimes="1" InteractByGossipOptions="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="2195.835" Y="5460.954" Z="-24.81545" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;L&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="2187.822" Y="5477.376" Z="-25.40438" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- clear area -->
                <CustomBehavior File="RunCode" Code="Print(&quot;M&quot;)" />
                <MoveTo X="2161.923" Y="5477.746" Z="-25.09356" />
                <MoveTo X="2189.668" Y="5517.879" Z="-25.09356" />
                <MoveTo X="2237.01" Y="5482.355" Z="-25.09342" />
                <MoveTo X="2201.452" Y="5441.978" Z="-25.09342" />
                <MoveTo X="2179.963" Y="5467.543" Z="-24.81754" />
                <!-- go upstairs -->
                <CustomBehavior File="RunCode" Code="Print(&quot;N&quot;)" />
                <MoveTo X="2224.338" Y="5467.907" Z="1.651839" />
                <MoveTo X="2111.187" Y="5489.16" Z="3.405121" />
                <!-- grab chest if we need it -->
                <CustomBehavior File="RunCode" Code="Print(&quot;AF&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="2115.111" Y="5492.513" Z="2.107438" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- collect mana rager if we need -->
                <CustomBehavior File="RunCode" Code="Print(&quot;O&quot;)" />
                <If Condition="!IsQuestCompleted(43146)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;Collecting Mana-Rager&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251742" NumOfTimes="1" InteractByGossipOptions="1" WaitForNpcs="false">
                        <HuntingGrounds>
                            <Hotspot X="2109.359" Y="5493.528" Z="2.526567" />
                        </HuntingGrounds>
                    </CustomBehavior>
                </If>
                <!-- go down -->
                <CustomBehavior File="RunCode" Code="Print(&quot;P&quot;)" />
                <MoveTo X="2109.6" Y="5501.621" Z="-12.25291" />
                <MoveTo X="2098.635" Y="5423.809" Z="-34.46243" />
                <!-- grab chest if we need it -->
                <CustomBehavior File="RunCode" Code="Print(&quot;AD&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="2097.004" Y="5443.904" Z="-34.06064" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" X="2102.527" Y="5390.494" Z="-36.91036" />
                <!-- grab chest if we need it -->
                <CustomBehavior File="RunCode" Code="Print(&quot;AD&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="2102.527" Y="5390.494" Z="-36.91036" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" X="2107.246" Y="5378.495" Z="-36.90988" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" X="2077.865" Y="5391.806" Z="-37.24174" />
                <!-- clear area -->
                <CustomBehavior File="RunCode" Code="Print(&quot;R&quot;)" />
                <MoveTo X="2101.689" Y="5383.314" Z="-36.90977" />
                <MoveTo X="2065.853" Y="5401.769" Z="-34.70255" />
                <MoveTo X="2098.635" Y="5423.809" Z="-34.46243" />
                <MoveTo X="2000.063" Y="5444.759" Z="-37.19492" />
                <CustomBehavior File="RunCode" Code="Print(&quot;[Zak]: Clearing and collecting hallway&quot;)" />
                <!-- get reduced runaway if we need -->
                <CustomBehavior File="RunCode" Code="Print(&quot;S&quot;)" />
                <If Condition="!IsQuestCompleted(43111)">
                    <CustomBehavior File="InteractWith" MobIds="251730" NumOfTimes="1" InteractByGossipOptions="1" WaitForNpcs="false">
                        <HuntingGrounds>
                            <Hotspot X="1986.89" Y="5443.457" Z="-36.58498" />
                        </HuntingGrounds>
                    </CustomBehavior>
                </If>
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;T&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1972.338" Y="5417" Z="-36.58504" />
                <!-- grab small chest if it's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;U&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="1962.555" Y="5411.252" Z="-36.09483" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- grab small chest if it's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;V&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="1935.463" Y="5358.436" Z="-36.09454" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;W&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="1900.282" Y="5353.309" Z="-36.09468" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- get small chest -->
                <CustomBehavior File="RunCode" Code="Print(&quot;X&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="1900.918" Y="5389.098" Z="-36.09454" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- go towards seer pickup -->
                <CustomBehavior File="RunCode" Code="Print(&quot;Y&quot;)" />
                <CustomBehavior File="RunCode" Code="Print(&quot;Going towards Seer pickup&quot;)" />
                <MoveTo X="1834.456" Y="5396.291" Z="-37.19594" />
                <!-- get small chest -->
                <CustomBehavior File="RunCode" Code="Print(&quot;Z&quot;)" />
                <CustomBehavior File="RunCode" Code="Print(&quot;Checking small chest&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="1826.736" Y="5392.343" Z="-37.19562" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- clear mobs -->
                <CustomBehavior File="RunCode" Code="Print(&quot;AA&quot;)" />
                <CustomBehavior File="RunCode" Code="Print(&quot;Clearing hall&quot;)" />
                <MoveTo X="1806.486" Y="5418.193" Z="-37.12412" />
                <MoveTo X="1819.562" Y="5443.314" Z="-36.62965" />
                <MoveTo X="1790.143" Y="5482.334" Z="-37.11425" />
                <MoveTo X="1804.501" Y="5508.26" Z="-36.82791" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;AB&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false">
                    <HuntingGrounds>
                        <Hotspot X="1792.901" Y="5517.201" Z="-36.60206" />
                    </HuntingGrounds>
                </CustomBehavior>
                <!-- collect seer if we need -->
                <CustomBehavior File="RunCode" Code="Print(&quot;AC&quot;)" />
                <If Condition="!IsQuestCompleted(43134)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;Getting Seer&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251743" NumOfTimes="1" CollectionDistance="20" InteractByGossipOptions="1" WaitForNpcs="false">
                        <HuntingGrounds>
                            <Hotspot X="1799.658" Y="5527.414" Z="-36.71957" />
                        </HuntingGrounds>
                    </CustomBehavior>
                </If>
                <CustomBehavior File="RunCode" Code="Print(&quot;AW&quot;)" />
                <MoveTo X="1848.885" Y="5590.573" Z="-66.0634" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" X="1845.218" Y="5589.861" Z="-66.0634" />
                <CustomBehavior File="RunCode" Code="Print(&quot;AX&quot;)" />
                <MoveTo X="1922.828" Y="5598.719" Z="-65.22453" />
                <!-- check if we have seer -->
                <If Condition="IsQuestCompleted(43134)">
                    <!-- TODO add use door step -->
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" X="1974.977" Y="5624.386" Z="-65.64427" WaitTime="1200" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" X="1974.977" Y="5624.386" Z="-65.64427" WaitTime="1200" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" X="1966.188" Y="5632.374" Z="-65.64427" WaitTime="1200" />
                    <!-- grab chest if we need it -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AD&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1965.128" Y="5637.899" Z="-65.64427" />
                    <!-- STARCALLER CHEST -->
                    <If Condition="!IsQuestCompleted(43135)">
                        <CustomBehavior File="RunCode" Code="Print(&quot;AY&quot;)" />
                        <CustomBehavior File="InteractWith" MobIds="251744" NumOfTimes="1" CollectionDistance="20" InteractByGossipOptions="1" WaitForNpcs="false" X="1968.865" Y="5628.337" Z="-65.6438" />
                    </If>
                </If>
                <CustomBehavior File="RunCode" Code="Print(&quot;AZ&quot;)" />
                <MoveTo X="1976.796" Y="5577.009" Z="-65.22607" />
                <MoveTo X="1986.209" Y="5539.057" Z="-65.22607" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1941.045" Y="5489.379" Z="-68.41636" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1920.216" Y="5510.435" Z="-68.35806" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1965.82" Y="5472.117" Z="-67.97966" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1933.793" Y="5419.9" Z="-68.41644" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1915.242" Y="5441.838" Z="-67.47449" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1902.186" Y="5472.925" Z="-67.47397" />
                <!-- grab chest if we need it -->
                <CustomBehavior File="RunCode" Code="Print(&quot;AD&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1891.177" Y="5470.383" Z="-67.47397" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1868.421" Y="5451.505" Z="-68.35838" />
                <!-- grab another guy if he's there -->
                <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1845.75" Y="5502.271" Z="-67.66523" />
                <!-- TREASURE CHEST -->
                <CustomBehavior File="RunCode" Code="Print(&quot;AY&quot;)" />
                <CustomBehavior File="InteractWith" MobIds="251725" NumOfTimes="1" CollectionDistance="20" InteractByGossipOptions="1" WaitForNpcs="false" X="1855.034" Y="5510.718" Z="-68.15792" />
                <!-- open door if we have spell seer -->
                <If Condition="IsQuestCompleted(43134)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;S-1&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251779" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1854.244" Y="5354.546" Z="-53.88261" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1826.426" Y="5327.204" Z="-57.26361" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1818.015" Y="5312.09" Z="-57.26361" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1800.014" Y="5265.219" Z="-57.01384" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1802.012" Y="5253.696" Z="-57.26296" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1818.567" Y="5248.662" Z="-57.26296" />
                    <!-- grab chest if we need it -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AD&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1798.917" Y="5262.75" Z="-57.06308" />
                    <!-- TREASURE CHEST -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AY&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251726" NumOfTimes="1" CollectionDistance="20" InteractByGossipOptions="1" WaitForNpcs="false" X="1809.575" Y="5254.774" Z="-57.26146" />
                </If>
                <!-- open door if we have spell seer -->
                <If Condition="IsQuestCompleted(43134)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;S-2&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251781" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1812.133" Y="5392.964" Z="-36.09425" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1803.98" Y="5333.153" Z="-36.64657" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1785.183" Y="5321.631" Z="-38.53296" />
                    <!-- grab chest if we need it -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AD&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1773.17" Y="5307.513" Z="-38.00289" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1761.726" Y="5306.701" Z="-38.53195" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1722.285" Y="5350.117" Z="-38.00419" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" CollectionDistance="20" NumOfTimes="1" WaitForNpcs="false" WaitTime="1200" X="1736.728" Y="5365.94" Z="-38.52919" />
                    <!-- MANA RAGER CHEST -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AY&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251741" NumOfTimes="1" CollectionDistance="20" InteractByGossipOptions="1" WaitForNpcs="false" X="1731.382" Y="5317.235" Z="-38.00378" />
                </If>
                <!-- use dro's key -->
                <CustomBehavior File="RunCode" Code="Print(&quot;AH&quot;)" />
                <If Condition="HasItem(141593)">
                    <CustomBehavior File="InteractWith" MobIds="259239" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1789.423" Y="5521.498" Z="-36.0944" />
                    <CustomBehavior File="RunCode" Code="Print(&quot;AI&quot;)" />
                    <MoveTo X="1730.877" Y="5546.329" Z="-36.07941" />
                    <MoveTo X="1672.341" Y="5587.852" Z="-57.82885" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;ZZ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1654.018" Y="5593.1" Z="-57.82885" />
                    <CustomBehavior File="RunCode" Code="Print(&quot;AK&quot;)" />
                    <MoveTo X="1687.688" Y="5600.241" Z="-57.89384" />
                    <MoveTo X="1700.933" Y="5608.882" Z="-57.89384" />
                    <MoveTo X="1725.995" Y="5619.699" Z="-57.89384" />
                    <!-- chest -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AL&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251954" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1737.485" Y="5637.328" Z="-56.97066" />
                    <CustomBehavior File="RunCode" Code="Print(&quot;AM&quot;)" />
                    <MoveTo X="1720.804" Y="5664.918" Z="-57.89439" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AN&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1720.804" Y="5664.918" Z="-57.89439" />
                    <CustomBehavior File="RunCode" Code="Print(&quot;AO&quot;)" />
                    <MoveTo X="1693.605" Y="5638.654" Z="-57.89355" />
                    <MoveTo X="1700.644" Y="5674.855" Z="-57.89374" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AP&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1666.3" Y="5666.313" Z="-57.89393" />
                    <!-- Berserker -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AQ&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251740" NumOfTimes="1" CollectionDistance="20" InteractByGossipOptions="1" WaitForNpcs="false" X="1700.644" Y="5674.855" Z="-57.89374" />
                    <!-- leave wing -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AR&quot;)" />
                    <MoveTo X="1675.209" Y="5595.51" Z="-56.98892" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AS&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1616.438" Y="5508.936" Z="-57.10097" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AT&quot;)" />
                    <MoveTo X="1633.375" Y="5477.652" Z="-57.94093" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1633.375" Y="5477.652" Z="-57.94093" />
                    <CustomBehavior File="RunCode" Code="Print(&quot;AU&quot;)" />
                    <MoveTo X="1617.025" Y="5415.456" Z="-57.09699" />
                    <!-- grab another guy if he's there -->
                    <CustomBehavior File="RunCode" Code="Print(&quot;AV&quot;)" />
                    <MoveTo X="1633.375" Y="5477.652" Z="-57.94093" />
                    <CustomBehavior File="InteractWith" MobIds="110141" FactionId1="1665" NumOfTimes="1" CollectionDistance="20" WaitForNpcs="false" X="1626.653" Y="5411.746" Z="-57.3508" />
                </If>
                <CustomBehavior File="RunCode" Code="Print(&quot;End Stage 2&quot;)" />
            </While>
            <!-- stage 3 -->
            <While Condition="StageNumber() == 3">
                <CustomBehavior File="RunCode" Code="Print(&quot;Looting reward chests&quot;)" />
                <While Condition="IsObjectNearby(251756)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;Looting chest: 251756&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251756" NumOfTimes="1" X="2098.582" Y="5395.352" Z="47.30122" WaitTime="1000" WaitForNpcs="false" />
                </While>
                <While Condition="IsObjectNearby(251757)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;Looting chest: 251757&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251757" NumOfTimes="1" X="2098.582" Y="5395.352" Z="47.30122" WaitTime="1000" WaitForNpcs="false" />
                </While>
                <While Condition="IsObjectNearby(251746)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;Looting chest: 251746&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251746" NumOfTimes="1" X="2098.582" Y="5395.352" Z="47.30122" WaitTime="1000" WaitForNpcs="false" />
                </While>
                <While Condition="IsObjectNearby(251747)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;Looting chest: 251747&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251747" NumOfTimes="1" X="2098.582" Y="5395.352" Z="47.30122" WaitTime="1000" WaitForNpcs="false" />
                </While>
                <While Condition="IsObjectNearby(251759)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;Looting chest: 251759&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251759" NumOfTimes="1" X="2098.582" Y="5395.352" Z="47.30122" WaitTime="1000" WaitForNpcs="false" />
                </While>
                <While Condition="IsObjectNearby(251668)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;Looting chest: 251668&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251668" NumOfTimes="1" X="2098.582" Y="5395.352" Z="47.30122" WaitTime="1000" WaitForNpcs="false" />
                </While>
                <While Condition="IsObjectNearby(251758)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;Looting chest: 251758&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="251758" NumOfTimes="1" X="2098.582" Y="5395.352" Z="47.30122" WaitTime="1000" WaitForNpcs="false" />
                </While>
                <While Condition="IsObjectNearby(252452)">
                    <CustomBehavior File="RunCode" Code="Print(&quot;Looting chest: 252452&quot;)" />
                    <CustomBehavior File="InteractWith" MobIds="252452" NumOfTimes="1" X="2098.582" Y="5395.352" Z="47.30122" WaitTime="1000" WaitForNpcs="false" />
                </While>
            </While>
            <!-- do our item pick ups / quest rewards -->
            <!-- 25% troop health -->
            <If Condition="IsQuestCompleted(43149) &amp;&amp; HasItem(139010)">
                <CustomBehavior File="UseItem" ItemId="139010" />
            </If>
            <!-- reduce runaway -->
            <If Condition="IsQuestCompleted(43111) &amp;&amp; HasItem(139017)">
                <CustomBehavior File="UseItem" ItemId="139017" />
            </If>
            <!-- mana-rager / Spellmask of Azsylla -->
            <If Condition="IsQuestCompleted(43146) &amp;&amp; HasItem(140451)">
                <CustomBehavior File="UseItem" ItemId="140451" />
            </If>
            <!-- spellseer / Lenses of Spellseer Dellian -->
            <If Condition="IsQuestCompleted(43134) &amp;&amp; HasItem(139027)">
                <CustomBehavior File="UseItem" ItemId="139027" />
            </If>
            <!-- mana-rager 2 / Spellmask of Alla'onus -->
            <If Condition="IsQuestCompleted(43128) &amp;&amp; HasItem(139019)">
                <CustomBehavior File="UseItem" ItemId="139019" />
            </If>
            <!-- starcaller / Disc of the Starcaller -->
            <If Condition="IsQuestCompleted(43135) &amp;&amp; HasItem(139028)">
                <CustomBehavior File="UseItem" ItemId="139028" />
            </If>
            <!-- use rep items -->
            <CustomBehavior File="RunCode" Code="Print(&quot;using rep items&quot;)" />
            <While Condition="HasItem(140260)">
                <CustomBehavior File="UseItem" ItemId="140260" WaitTime="2000" />
            </While>
            <While Condition="HasItem(141870)">
                <CustomBehavior File="UseItem" ItemId="141870" WaitTime="2000" />
            </While>
            <!-- TODO check zoneid -->
            <CustomBehavior File="InteractWith" MobIds="258976" NumOfTimes="1" X="2098.582" Y="5395.352" Z="47.30122" WaitForNpcs="false" />
            <CustomBehavior File="RunMacro" Macro="/click StaticPopup1Button1" />
        </If>
        <!-- suramar bank? -->
        <If Condition="HasQuest(44176)">
            <If Condition="!IsQuestCompleted(44176)">
                <CustomBehavior File="InteractWith" MobIds="113295" NumOfTimes="1" X="1689.074" Y="4559.487" Z="123.9887" WaitTime="1000" />
            </If>
            <TurnIn Nav="Fly" QuestName="The Conveniences of Home" QuestId="44176" TurnInName="Traveler's Banking Chest" TurnInId="113284" />
        </If>
        <CustomBehavior File="LoadProfile" ProfileName="./[N] The Nightfallen Rep" RememberProfile="true" />
    </QuestOrder>
</HBProfile>
