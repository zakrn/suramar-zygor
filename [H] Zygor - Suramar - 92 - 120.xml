<HBProfile xsi:noNamespaceSchemaLocation="../Schemas/EchoSchema.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Name>[H] Zygor Suramar 92 - 120</Name>
    <MinDurability>0.3</MinDurability>
    <MinFreeBagSlots>3</MinFreeBagSlots>
    <SellGrey>true</SellGrey>
    <SellWhite>false</SellWhite>
    <SellGreen>false</SellGreen>
    <SellBlue>false</SellBlue>
    <SellPurple>false</SellPurple>
    <MailGrey>false</MailGrey>
    <MailWhite>true</MailWhite>
    <MailGreen>true</MailGreen>
    <MailBlue>true</MailBlue>
    <MailPurple>true</MailPurple>
    <TargetElites>true</TargetElites>
    <!--These aren't used often, only if there are navigation issues with the profile or areas you want the character to avoid-->
    <Blackspots>
        <Blackspot X="5677.544" Y="4255.224" Z="695.3536" Radius="12.15873" />
        <!-- Large fire that bot can get stuck in -->
    </Blackspots>
    <!--These are the vendors you want the bot to go to when doing a repair or vendor run-->
    <Vendors>
    </Vendors>
    <!--These are the locations of the available mailboxes that you want your character to use-->
    <Mailboxes>
    </Mailboxes>
    <!--Setting these would make sure the character stays away from and does not attack these mobs-->
    <AvoidMobs>
    </AvoidMobs>
    <!--Here is where the meat of the profile will take place-->
    <QuestOrder>
        <CustomBehavior File="RunCode" Type="Definition">
            <![CDATA[
                    bool DoQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (HasQuest(questId) && !IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }
                    bool NeedsQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (!HasQuest(questId) && !IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }
                    bool NeedsBreadcrumbQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (IsQuestCompleted(questId)) return false;
                        }
                        return true;
                    }
                    bool QuestDone(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (HasQuest(questId) && IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }

                    bool HasAncientMana( uint amount )
                    {
                        return WoWCurrency.GetCurrencyById(1155) != null && WoWCurrency.GetCurrencyById(1155).Amount >= amount;
                    }

                    void PrintStep( uint step )
                    {
                        Logging.Write(System.Windows.Media.Colors.Yellow, "[Zak]: " + step);
                    }

                    async Task SkipCutscene(int preWait = 3000, int postWait = 3000)
                    {
                // Add detection of cutscene here.
                        await Coroutine.Sleep(preWait);
                // Test and improve the working method.
                        Lua.DoString("MovieFrame:StopMovie(); CinematicFrame_CancelCinematic(); StopCinematic();");
                        await Coroutine.Sleep(postWait);
                    }
                ]]>
        </CustomBehavior>

        <CustomBehavior File="RunCode" Code="Logging.Write(System.Windows.Media.Colors.Yellow, &quot;[Zak]: Zygor - Suramar Steps 92 - 120&quot;);" />

        <!-- 92 -->
        <CustomBehavior File="RunCode" Code="PrintStep(92)" />
        <PickUp Nav="Fly" QuestName="Tapping the Leylines" QuestId="40010" GiverName="First Arcanist Thalyssra" GiverId="97140" X="1707.338" Y="4630.285" Z="124.0054" />

        <!-- 93 -->
        <CustomBehavior File="RunCode" Code="PrintStep(93)" />
        <If Condition="DoQuest(40010) &amp;&amp; !IsObjectiveComplete(1, 40010)">
            <CustomBehavior File="InteractWith" MobId="254129" WaitTime="3000" X="1783.168" Y="4640.48" Z="124.789"  />
        </If>

        <!-- 94 -->
        <CustomBehavior File="RunCode" Code="PrintStep(94)" />
<!--         <If Condition="DoQuest(40010) &amp;&amp; !IsObjectiveComplete(2, 40010)">
            <MoveTo Nav="Fly" X="2001.544" Y="4356.024" Z="163.3702" />
        </If> -->

        <!-- 95 -->
        <CustomBehavior File="RunCode" Code="PrintStep(95)" />
        <PickUp Nav="Fly" QuestName="Tel'anor'eporter Online!" QuestId="43809" GiverName="Unpowered Telemancy Beacon" GiverId="252817" X="2139.617" Y="4323.337" Z="258.0854"  />
        
        <!-- 96  --> 
        <CustomBehavior File="RunCode" Code="PrintStep(96)" />
        <If Condition="DoQuest(43809)  &amp;&amp; !HasAncientMana(100)">
            <CustomBehavior File="LoadProfile" ProfileName="gather\[N]-Ancient-Mana-Zinner-Zak-100" RememberProfile="true" />
        </If>

        <!-- 97 -->
        <CustomBehavior File="RunCode" Code="PrintStep(97)" />
        <If Condition="QuestDone(43809) &amp;&amp; HasAncientMana(100)">
            <TurnIn Nav="Fly" QuestName="Tel'anor'eporter Online!" QuestId="43809" TurnInName="Unpowered Telemancy Beacon" TurnInId="252817" X="2139.617" Y="4323.337" Z="258.0854" />
        </If>

        <!-- 98 -->
        <CustomBehavior File="RunCode" Code="PrintStep(98)" />
        <IF Condition="DoQuest(40010) &amp;&amp; !IsObjectiveComplete(2, 40010)">
            <MoveTo X="2011.139" Y="4350.546" Z="164.8867" />
        </IF>

        <!-- 99 -->
        <CustomBehavior File="RunCode" Code="PrintStep(99)" />
        <PickUp Nav="Fly" QuestName="Turtle Powered" QuestId="40368" GiverName="Morhun Rivertamer" GiverId="99788" X="1901.087" Y="4250.872" Z="192.39"  />

        <!-- 100 -->
        <CustomBehavior File="RunCode" Code="PrintStep(100)" />
        <While Condition="DoQuest(40368)">
            <CustomBehavior File="KillUntilComplete" MobIds="113125" QuestId="40368" TerminateWhen="IsQuestCompleted(40368)">
                <HuntingGrounds>
                    <Hotspot X="2149.204" Y="4533.311" Z="168.2968" />
                    <Hotspot X="2223.377" Y="4434.439" Z="168.2103" />
                    <Hotspot X="1988.07" Y="4391.601" Z="158.8909" />
                    <Hotspot X="1978.225" Y="4659.908" Z="167.506" />
                </HuntingGrounds>
            </CustomBehavior>
        </While>

        <!-- 101 -->
        <CustomBehavior File="RunCode" Code="PrintStep(101)" />
        <!-- bot just stops oddly here, doesnt move to quest xyz, manually move -->
        <TurnIn Nav="Fly" QuestName="Turtle Powered" QuestId="40368" TurnInName="Morhun Rivertamer" TurnInId="99788"  X="1903.078" Y="4258.906" Z="192.6073"  />
        <PickUp Nav="Fly" QuestName="Something in the Water" QuestId="40348" GiverName="Morhun Rivertamer" GiverId="99788" X="1903.078" Y="4258.906" Z="192.6073" />
        <PickUp Nav="Fly" QuestName="Purge the Unclean" QuestId="40370" GiverName="Morhun Rivertamer" GiverId="99788" X="1903.078" Y="4258.906" Z="192.6073" />

        <!-- 102 -->
        <CustomBehavior File="RunCode" Code="PrintStep(102)" />

        <If Condition="DoQuest(40348)">
            <CustomBehavior File="KillUntilComplete" TerminateWhen="IsObjectiveComplete(1,40348)" MobId="99789">
                    <HuntingGrounds>
                        <Hotspot X="1914.462" Y="4226.851" Z="186.6151" />
                        <Hotspot X="1828.023" Y="4107.956" Z="187.2927" />
                        <Hotspot X="1814.273" Y="4029.974" Z="222.6178" />
                        <Hotspot X="2050.366" Y="4064.027" Z="219.4372" />
                        <Hotspot X="2011.812" Y="4226.075" Z="219.4522" />
                    </HuntingGrounds>   
            </CustomBehavior>
        </If>

        <!-- 103 -->
        <CustomBehavior File="RunCode" Code="PrintStep(103)" />
        <If Condition="DoQuest(40370)">
            <CustomBehavior File="UserDialog" QuestId="40370" AllowBotStop="True" SoundCue="Exclamation" SoundCueInterval="1" Text="I had some issues getting this to work, so it may not work as expected. You have to take manual control, but the quest is fairly simple." />
            <CustomBehavior File="Hooks\DoWhen" ActivityName="PurgeMob" AllowUseDuringCombat="true" LogExecution="true" UseAtInterval="4000" >
               <CustomBehavior File="UseItem" ItemId="131760" />
            </CustomBehavior>
            <CustomBehavior File="KillUntilComplete" TerminateWhen="IsObjectiveComplete(1,40370)" MobIds="99859, 99882">
                <HuntingGrounds>
                    <Hotspot X="2074.563" Y="4006.621" Z="219.5088"  />
                </HuntingGrounds>   
            </CustomBehavior>
            <CustomBehavior File="Hooks\DoWhen" ActivityName="PurgeMob" Command="Remove" />
        </If>


        <!-- 104 -->
        <CustomBehavior File="RunCode" Code="PrintStep(104)" />
        <TurnIn Nav="Fly" QuestName="Something in the Water" QuestId="40348" TurnInName="Morhun Rivertamer" TurnInId="99788" X="1904.124" Y="4246.788" Z="191.628" />
        <TurnIn Nav="Fly" QuestName="Purge the Unclean" QuestId="40370" TurnInName="Morhun Rivertamer" TurnInId="99788" X="1904.124" Y="4246.788" Z="191.628" />

        <!-- 105 -->
        <CustomBehavior File="RunCode" Code="PrintStep(105)" />
        <If Condition="DoQuest(40010)">
            <CustomBehavior File="InteractWith" MobId="102600" InteractByGossipOptions="1" WaitTime="3000" X="2000.038" Y="4349.769" Z="163.9751" />
            <CustomBehavior File="WaitTimer" WaitTime="30000" />
        </If>

        <!-- 106 -->
        <CustomBehavior File="RunCode" Code="PrintStep(106)" />
        <TurnIn Nav="Fly" QuestName="Tapping the Leylines" QuestId="40010" TurnInName="Arcanist Valtrois" TurnInId="102600" X="2013.488" Y="4252.934" Z="166.4541" />
        <PickUp Nav="Fly" QuestName="Power Grid" QuestId="41028" GiverName="Arcanist Valtrois" GiverId="102600" X="2013.488" Y="4252.934" Z="166.4541" />

        <!-- 107 -->
        <CustomBehavior File="RunCode" Code="PrintStep(107)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(1,41028)">
            <CustomBehavior File="InteractWith" MobId="246762" X="1941.441" Y="4172.089" Z="166.9342" />
        </If>

        <!-- 108 -->
        <CustomBehavior File="RunCode" Code="PrintStep(108)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(1,41028)">
            <CustomBehavior File="InteractWith" MobId="246886" X="1968.484" Y="4196.602" Z="168.0005" />
        </If>

        <!-- 109 -->
        <CustomBehavior File="RunCode" Code="PrintStep(109)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(2,41028)">
            <CustomBehavior File="InteractWith" MobId="246759" X="1958.444" Y="4193.181" Z="166.7697" />
        </If>

        <!-- 110 -->
        <CustomBehavior File="RunCode" Code="PrintStep(110)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(2,41028)">
            <CustomBehavior File="InteractWith" MobId="246758" X="1898.625" Y="4111.471" Z="168.2814" />
        </If>

        <!-- 111 -->
        <CustomBehavior File="RunCode" Code="PrintStep(111)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(2,41028)">
            <CustomBehavior File="InteractWith" MobId="246833" X="1948.363" Y="4165.92" Z="167.0708"  />
        </If>

        <!-- 112 -->
        <CustomBehavior File="RunCode" Code="PrintStep(112)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(2,41028)">
            <CustomBehavior File="InteractWith" MobId="246913" X="1971.538" Y="4163.739" Z="168.8583" />
        </If>

        <!-- 113 -->
        <CustomBehavior File="RunCode" Code="PrintStep(113)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(3,41028)">
            <CustomBehavior File="InteractWith" MobId="246757" X="2009.842" Y="4244.258" Z="166.6262" />
        </If>

        <!-- 114 -->
        <CustomBehavior File="RunCode" Code="PrintStep(114)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(3,41028)">
            <CustomBehavior File="InteractWith" MobId="246833" X="1948.363" Y="4165.92" Z="167.0708" />
        </If>

        <!-- 115 -->
        <CustomBehavior File="RunCode" Code="PrintStep(115)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(3,41028)">
            <CustomBehavior File="InteractWith" MobId="246914" X="1938.649" Y="4160.887" Z="168.6007" />
        </If>

        <!-- 116 -->
        <CustomBehavior File="RunCode" Code="PrintStep(116)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(4,41028)">
            <CustomBehavior File="InteractWith" MobId="246758" X="1898.625" Y="4111.471" Z="168.2814" />
        </If>

        <!-- 117 -->
        <CustomBehavior File="RunCode" Code="PrintStep(117)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(4,41028)">
            <CustomBehavior File="InteractWith" MobId="246761" X="1966.53" Y="4186.626" Z="167.0288" />
        </If>

        <!-- 118 -->
        <CustomBehavior File="RunCode" Code="PrintStep(118)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(4,41028)">
            <CustomBehavior File="InteractWith" MobId="246762" X="1941.441" Y="4172.089" Z="166.9342" />
        </If>

        <!-- 119 -->
        <CustomBehavior File="RunCode" Code="PrintStep(119)" />
        <If Condition="DoQuest(41028) &amp;&amp; !IsObjectiveComplete(4,41028)">
            <CustomBehavior File="InteractWith" MobId="246916" X="1935.738" Y="4193.576" Z="168.0016" />
        </If>

        <!-- 120 -->
        <CustomBehavior File="RunCode" Code="PrintStep(120)" />
        <TurnIn Nav="Fly" QuestName="Power Grid" QuestId="41028" TurnInName="Arcanist Valtrois" TurnInId="102600" X="2013.488" Y="4252.934" Z="166.4541" />

        <CustomBehavior File="LoadProfile" ProfileName="[H] Zygor - Suramar - 121 - 169" RememberProfile="true" />

    </QuestOrder>
</HBProfile>
