<HBProfile xsi:noNamespaceSchemaLocation="../Schemas/EchoSchema.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Name>[H] Zygor Suramar 170 - X</Name>
    <MinDurability>0.3</MinDurability>
    <MinFreeBagSlots>3</MinFreeBagSlots>
    <SellGrey>true</SellGrey>
    <SellWhite>false</SellWhite>
    <SellGreen>false</SellGreen>
    <SellBlue>false</SellBlue>
    <SellPurple>false</SellPurple>
    <MailGrey>false</MailGrey>
    <MailWhite>true</MailWhite>
    <MailGreen>true</MailGreen>
    <MailBlue>true</MailBlue>
    <MailPurple>true</MailPurple>
    <TargetElites>true</TargetElites>
    <!--These aren't used often, only if there are navigation issues with the profile or areas you want the character to avoid-->
    <Blackspots>
        <Blackspot X="879.0854" Y="5259.045" Z="48.92279" Radius="2.93233" />
    </Blackspots>
    <!--These are the vendors you want the bot to go to when doing a repair or vendor run-->
    <Vendors>
        <Vendor Name="Felsoul Crusher" Entry="99764" Type="Repair" Nav="Fly" X="1122.2" Y="5189.969" Z="67.72179" />
    </Vendors>
    <!--These are the locations of the available mailboxes that you want your character to use-->
    <Mailboxes>
    </Mailboxes>
    <!--Setting these would make sure the character stays away from and does not attack these mobs-->
    <AvoidMobs>
        <Mob Name="Koralune Ettin" Entry="99791" />
        <Mob Name="Elfbane" Entry="99792" />
    </AvoidMobs>
    <!--Here is where the meat of the profile will take place-->
    <QuestOrder>
        <CustomBehavior File="RunCode" Type="Definition">
            <![CDATA[
                    bool DoQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (HasQuest(questId) && !IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }
                    bool NeedsQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (!HasQuest(questId) && !IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }
                    bool NeedsBreadcrumbQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (IsQuestCompleted(questId)) return false;
                        }
                        return true;
                    }
                    bool QuestDone(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (HasQuest(questId) && IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }

                    bool HasAncientMana( uint amount )
                    {
                        return WoWCurrency.GetCurrencyById(1155) != null && WoWCurrency.GetCurrencyById(1155).Amount >= amount;
                    }

                    uint MaxAncientMana()
                    {
                        if( WoWCurrency.GetCurrencyById(1155) != null )
                        {
                            return WoWCurrency.GetCurrencyById(1155).TotalMax;
                        }
                        return 0;
                    }

                    async Task CastMask()
                    {
                        if( Me.ZoneId == 7637 && !Me.HasAura(202477) )
                        {
                            Lua.DoString("ExtraActionButton1:Click();");
                            await Coroutine.Sleep(1400);
                        }
                    }

                    bool IsThirsty( uint friendId )
                    {
                        List<string> values = Lua.GetReturnValues("return GetFriendshipReputation(" + friendId +")");

                        if( values.Count == 0 )
                        {   
                            Logging.Write(System.Windows.Media.Colors.Red, "[Zak]: Failed to get arcane thirst");
                            return false;
                        }

                        int level = Int32.Parse( values[1]);
                        int threshold = Int32.Parse( values[7]);
                        int newlevel = level - threshold;

                        return newlevel <= 1;
                    }

                    bool IsThalyssraThirsty()
                    {
                        return IsThirsty(1860);
                    }

                    bool IsOculethThirsty()
                    {
                        return IsThirsty(1862);
                    }

                    bool IsValtroisThirsty()
                    {
                        return IsThirsty(1919);
                    }

                    void PrintStep( uint step )
                    {
                        Logging.Write(System.Windows.Media.Colors.Yellow, "[Zak]: " + step);
                    }

                    async Task SkipCutscene(int preWait = 3000, int postWait = 3000)
                    {
                // Add detection of cutscene here.
                        await Coroutine.Sleep(preWait);
                // Test and improve the working method.
                        Lua.DoString("MovieFrame:StopMovie(); CinematicFrame_CancelCinematic(); StopCinematic();");
                        await Coroutine.Sleep(postWait);
                    }
                ]]>
        </CustomBehavior>
        <CustomBehavior File="RunCode" Code="Logging.Write(System.Windows.Media.Colors.Yellow, &quot;[Zak]: Zygor - Suramar Steps 170 - X&quot;);" />
        <CustomBehavior File="RunCode" Code="Logging.Write(System.Windows.Media.Colors.Yellow, &quot;[Zak]: ZoneId: &quot; + Me.ZoneId);" />
        <CustomBehavior File="RunCode" Code="Logging.Write(System.Windows.Media.Colors.Yellow, &quot;[Zak]: MaxMana: &quot; + MaxAncientMana());" />

        <!-- 170 -->
        <CustomBehavior File="RunCode" Code="PrintStep(170)" />
        <!-- Just a moveto -->

        <!-- 171 -->
        <CustomBehavior File="RunCode" Code="PrintStep(171)" />
        <TurnIn Nav="Fly" QuestName="Cloaked in Moonshade" QuestId="42224" TurnInName="Moonshade Relic" TurnInId="250383" X="2043.991" Y="5693.085" Z="85.64674" />
        <PickUp Nav="Fly" QuestName="Breaking the Seal" QuestId="42225" GiverName="Moonshade Relic" GiverId="250383" X="2043.991" Y="5693.085" Z="85.64674" />

        <!-- 172 -->
        <CustomBehavior File="RunCode" Code="PrintStep(172)" />
        <If Condition="DoQuest(42225) &amp;&amp; !IsObjectiveComplete(1,42225)" >
            <CustomBehavior File="InteractWith" MobId="250382" X="2041.389" Y="5710.63" Z="86.13902" />
        </If>

        <!-- 173 -->
        <CustomBehavior File="RunCode" Code="PrintStep(173)" />
        <If Condition="DoQuest(42225) &amp;&amp; !IsObjectiveComplete(1,42225)" >
            <CustomBehavior File="InteractWith" MobId="250378" X="2041.752" Y="5695.899" Z="85.64749" />
        </If>

        <!-- 174 -->
        <CustomBehavior File="RunCode" Code="PrintStep(174)" />
        <If Condition="DoQuest(42225) &amp;&amp; !IsObjectiveComplete(2,42225)" >
            <CustomBehavior File="InteractWith" MobId="250382" X="2041.389" Y="5710.63" Z="86.13902" />
        </If>

        <!-- 175 -->
        <CustomBehavior File="RunCode" Code="PrintStep(175)" />
        <If Condition="DoQuest(42225) &amp;&amp; !IsObjectiveComplete(2,42225)" >
            <CustomBehavior File="InteractWith" MobId="250379" X="2033.009" Y="5702.615" Z="85.02367" />
        </If>

        <!-- 176 -->
        <CustomBehavior File="RunCode" Code="PrintStep(176)" />
        <If Condition="DoQuest(42225) &amp;&amp; !IsObjectiveComplete(2,42225)" >
            <CustomBehavior File="InteractWith" MobId="250381" X="2050.264" Y="5681.919" Z="86.05747" />
        </If>

        <!-- 177 -->
        <CustomBehavior File="RunCode" Code="PrintStep(177)" />
        <If Condition="DoQuest(42225) &amp;&amp; !IsObjectiveComplete(2,42225)" >
            <CustomBehavior File="InteractWith" MobId="250666" X="2046.785" Y="5697.388" Z="85.847" />
        </If>

        <!-- 178 -->
        <CustomBehavior File="RunCode" Code="PrintStep(178)" />
        <If Condition="DoQuest(42225) &amp;&amp; !IsObjectiveComplete(3,42225)" >
            <CustomBehavior File="InteractWith" MobId="250380" X="2057.37" Y="5689.786" Z="86.30775" />
        </If>

        <!-- 179 -->
        <CustomBehavior File="RunCode" Code="PrintStep(179)" />
        <If Condition="DoQuest(42225) &amp;&amp; !IsObjectiveComplete(3,42225)" >
            <CustomBehavior File="InteractWith" MobId="250381" X="2050.264" Y="5681.919" Z="86.05747" />
        </If>

        <!-- 180 -->
        <CustomBehavior File="RunCode" Code="PrintStep(180)" />
        <If Condition="DoQuest(42225) &amp;&amp; !IsObjectiveComplete(3,42225)" >
            <CustomBehavior File="InteractWith" MobId="250667" X="2047.325" Y="5695.16" Z="85.81974" />
        </If>

        <!-- 181 -->
        <CustomBehavior File="RunCode" Code="PrintStep(181)" />
        <TurnIn Nav="Fly" QuestName="Breaking the Seal" QuestId="42225" TurnInName="Moonshade Relic" TurnInId="250383" X="2043.991" Y="5693.085" Z="85.64674" />

        <!-- Moonshade Hideout accepted automatically -->

        <!-- 182 -->
        <CustomBehavior File="RunCode" Code="PrintStep(182)" />
        <If Condition="DoQuest(42226)">
            <CustomBehavior File="KillUntilComplete" MobIds="107856, 107853, 107857, 107888" QuestId="42226" TerminateWhen="QuestDone(42226)" >
                <HuntingGrounds>
                    <Hotspot X="2031.729" Y="5676.135" Z="85.98132" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <!-- 183 -->
        <CustomBehavior File="RunCode" Code="PrintStep(183)" />
        <TurnIn Nav="Fly" QuestName="Moonshade Holdout" QuestId="42226" TurnInName="Valewalker Farodin" TurnInId="107126" X="2043.991" Y="5693.085" Z="85.64674" />
        <PickUp Nav="Fly" QuestName="Into the Crevasse" QuestId="42227" GiverName="Valewalker Farodin" GiverId="107126" X="2043.991" Y="5693.085" Z="85.64674" />

        <!-- 184 -->
        <CustomBehavior File="RunCode" Code="PrintStep(184)" />
        <If Condition="DoQuest(42227) &amp;&amp; !IsObjectiveComplete(1, 42227)">
            <MoveTo X="1893.406" Y="5523.812" Z="24.90339" />
            <CustomBehavior File="WaitTimer" WaitTime="30000" TerminateWhen="IsObjectiveComplete(1, 42227)" />
            <!-- <CustomBehavior File="Escort" QuestId="42227" MobId="107126" EscortUntil="DestinationReached" EscortDestX="1892.924"  EscortDestY="5522.651"  EscortDestZ="24.36934" /> -->
            <CustomBehavior File="ForcedDismount" />
            <CustomBehavior File="WaitTimer" WaitTime="500" />
            <CustomBehavior File="Misc\RunLua" Lua="MoveForwardStart();" WaitTime="500" />
            <CustomBehavior File="Misc\RunLua" Lua="MoveForwardStop();" WaitTime="100" />
        </If>

        <!-- 185 -->
        <CustomBehavior File="RunCode" Code="PrintStep(185)" />
        <If Condition="DoQuest(42227)">
            <CustomBehavior File="ForcedDismount" />
            <CustomBehavior File="WaitTimer" WaitTime="500" />
            <CustomBehavior File="Misc\RunLua" Lua="MoveForwardStart();" WaitTime="500" />
            <CustomBehavior File="Misc\RunLua" Lua="MoveForwardStop();" WaitTime="100" />
        </If>

        <!-- 186 -->
        <CustomBehavior File="RunCode" Code="PrintStep(186)" />
        <TurnIn Nav="Fly" QuestName="Into the Crevasse" QuestId="42227" TurnInName="Valewalker Farodin" TurnInId="107126" X="1877.637" Y="5475.554" Z="-68.12977" />
        <PickUp Nav="Fly" QuestName="The Hidden City" QuestId="42228" GiverName="Valewalker Farodin" GiverId="107126" X="1877.637" Y="5475.554" Z="-68.12977" />

        <!-- 187 -->
        <CustomBehavior File="RunCode" Code="PrintStep(187)" />
        <PickUp Nav="Fly" QuestName="Leyline Feed: Falanaar Depths" QuestId="43593" GiverName="Leyline Feed" GiverId="252263" X="1624.266" Y="5369.372" Z="-59.86499" />

        <!-- 188 -->
        <CustomBehavior File="RunCode" Code="PrintStep(188)" />
        <If Condition="DoQuest(43593) &amp;&amp; !HasAncientMana(250)">
            <CustomBehavior File="LoadProfile" ProfileName="gather\[N]-Ancient-Mana-Zinner-Zak-300" RememberProfile="true" />
        </If>

        <!-- 189 -->
        <CustomBehavior File="RunCode" Code="PrintStep(189)" />
        <TurnIn Nav="Fly" QuestName="Leyline Feed: Falanaar Depths" QuestId="43593" TurnInName="Leyline Feed" TurnInId="252263" X="1624.266" Y="5369.372" Z="-59.86499" />

        <!-- 190 -->
        <CustomBehavior File="RunCode" Code="PrintStep(190)" />
        <PickUp Nav="Fly" QuestName="Leyline Feed: Falanaar Arcway" QuestId="43592" GiverName="Leyline Feed" GiverId="252262" X="1807.095" Y="5264.879" Z="-57.26294" />

        <!-- 191 -->
        <CustomBehavior File="RunCode" Code="PrintStep(191)" />
        <If Condition="DoQuest(43592) &amp;&amp; !HasAncientMana(250)">
            <CustomBehavior File="LoadProfile" ProfileName="gather\[N]-Ancient-Mana-Zinner-Zak-300" RememberProfile="true" />
        </If>

        <!-- 192 -->
        <CustomBehavior File="RunCode" Code="PrintStep(192)" />
        <TurnIn Nav="Fly" QuestName="Leyline Feed: Falanaar Arcway" QuestId="43592" TurnInName="Leyline Feed" TurnInId="252262" X="1807.095" Y="5264.879" Z="-57.26294" />

        <!-- 193 -->
        <CustomBehavior File="RunCode" Code="PrintStep(193)" />
        <If Condition="DoQuest(42228)">
            <CustomBehavior File="KillUntilComplete" MobIds="107959" QuestId="42228" TerminateWhen="QuestDone(42228)" >
                <HuntingGrounds>
                    <Hotspot X="2185.781" Y="5481.971" Z="1.592235" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <!-- 194 -->
        <CustomBehavior File="RunCode" Code="PrintStep(194)" />
        <TurnIn Nav="Fly" QuestName="The Hidden City" QuestId="42228" TurnInName="Ancient Seed" TurnInId="108101" X="2187.691" Y="5480.94" Z="1.592952" />
        <PickUp Nav="Fly" QuestName="The Valewalker's Burden" QuestId="42230" GiverName="Ancient Seed" GiverId="108101" X="2187.691" Y="5480.94" Z="1.592952" />

        <!-- 195 -->
        <CustomBehavior File="RunCode" Code="PrintStep(195)" />
        <If Condition="DoQuest(42230) &amp;&amp; !IsObjectiveComplete(1,42230)" >
            <CustomBehavior File="InteractWith" MobId="251047" X="2370.608" Y="5442.983" Z="15.95275" />
            <!-- wait for teleport -->
            <CustomBehavior File="WaitTimer" WaitTime="30000" />
        </If>

        <!-- 196 -->
        <CustomBehavior File="RunCode" Code="PrintStep(196)" />
        <If Condition="QuestDone(42230)">
            <MoveTo X="1722.773" Y="4614.757" Z="123.7993" />
            <TurnIn Nav="Fly" QuestName="The Valewalker's Burden" QuestId="42230" TurnInName="Doodad_7sr_hubmanatree_seedholder001" TurnInId="265435" X="1722.773" Y="4614.757" Z="123.7993" />
            <!-- movie -->
            <CustomBehavior File="WaitTimer" WaitTime="30000" />
        </If>

        <!-- 197 -->
        <CustomBehavior File="RunCode" Code="PrintStep(197)" />
        <!-- hb was stopping here for some reason with just a regular pickup block idk -->
        <If Condition="!IsQuestCompleted(44561) &amp;&amp; !HasQuest(44561)">
            <CustomBehavior File="InteractWith" MobId="107126" X="1722.54" Y="4615.137" Z="123.8005" />
            <CustomBehavior File="Misc\RunLua" Lua="AcceptQuest()" WaitTime="200" />
            <!-- <PickUp Nav="Fly" QuestName="Seed of Hope" QuestId="44561" GiverName="Valewalker Farodin" GiverId="107126" X="1722.54" Y="4615.137" Z="123.8005" /> -->
        </If>
        
        <!-- 198 -->
        <CustomBehavior File="RunCode" Code="PrintStep(198)" />
        <!-- check if he is thirsty and unlock if we have mana, otherwise go get some -->
        <If Condition="!IsQuestCompleted(44492) &amp;&amp; IsValtroisThirsty()">
            <If Condition="!HasAncientMana(50)">
                <CustomBehavior File="LoadProfile" ProfileName="[N]-[QUEST]-Ancient-Mana-Zinner" RememberProfile="true" />
            </If>
            <CustomBehavior File="InteractWith" MobId="103155" X="1732.071" Y="4605.52" Z="123.8043"  />
            <CustomBehavior File="Misc\RunLua" Lua="QuestFrameCompleteButton:Click()" WaitTime="200" />
            <CustomBehavior File="Misc\RunLua" Lua="QuestFrameCompleteQuestButton:Click()" WaitTime="200" />
        </If>

        <PickUp Nav="Fly" QuestName="Leyline Apprentice" QuestId="44492" GiverName="Arcanist Valtrois" GiverId="103155" X="1732.071" Y="4605.52" Z="123.8043" />

        <!-- 199 -->
        <CustomBehavior File="RunCode" Code="PrintStep(199)" />
        <TurnIn Nav="Fly" QuestName="Leyline Apprentice" QuestId="44492" TurnInName="Arcanist Valtrois" TurnInId="103155" X="1732.071" Y="4605.52" Z="123.8043" />

        <!-- 200 -->
        <CustomBehavior File="RunCode" Code="PrintStep(200)" />
        <TurnIn Nav="Fly" QuestName="The Only Choice We Can Make" QuestId="41467" TurnInName="Mayruna Moonwing" TurnInId="103568" X="2298.161" Y="5231.146" Z="107.7191" />
        <PickUp Nav="Fly" QuestName="Redhoof the Ancient" QuestId="41473" GiverName="Mayruna Moonwing" GiverId="103568" X="2298.161" Y="5231.146" Z="107.7191" />

        <!-- 201 -->
        <CustomBehavior File="RunCode" Code="PrintStep(201)" />
        <TurnIn Nav="Fly" QuestName="Redhoof the Ancient" QuestId="41473" TurnInName="Mythandros Irongrove" TurnInId="103569" X="2347.255" Y="5091.745" Z="112.6199" />
        <PickUp Nav="Fly" QuestName="Fertilizing the Future" QuestId="41474" GiverName="Mythandros Irongrove" GiverId="103569" X="2347.255" Y="5091.745" Z="112.6199" />
        <PickUp Nav="Fly" QuestName="Prongs and Fangs" QuestId="41475" GiverName="Mythandros Irongrove" GiverId="103569" X="2347.255" Y="5091.745" Z="112.6199" />

        <!-- 202 -->
        <CustomBehavior File="RunCode" Code="PrintStep(202)" />
        <!-- 203 -->
        <CustomBehavior File="RunCode" Code="PrintStep(203)" />
        <!-- 204 -->
        <CustomBehavior File="RunCode" Code="PrintStep(204)" />
        <If Condition="DoQuest(41474)" >
            <CustomBehavior File="InteractWith" MobId="248114" NumOfTimes="500" TerminateWhen="IsQuestCompleted(41474)">
                <HuntingGrounds>
                    <Hotspot X="2150.961" Y="5147.301" Z="125.5595" />
                    <Hotspot X="2204.618" Y="5138.357" Z="123.2354" />
                    <Hotspot X="2253.21" Y="5127.307" Z="125.3089" />
                    <Hotspot X="2155.137" Y="4955.449" Z="138.7735" />
                    <Hotspot X="2143.054" Y="4897.685" Z="155.3225" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <!-- 205 -->
        <CustomBehavior File="RunCode" Code="PrintStep(205)" />
        <If Condition="DoQuest(41475)" >
            <CustomBehavior File="KillUntilComplete" MobIds="104226" TerminateWhen="IsObjectiveComplete(2, 41475)" >
                 <HotSpots>
                    <Hotspot X="2244.476" Y="5010.06" Z="137.113" />
                </HotSpots>
            </CustomBehavior>
        </If>

        <!-- 206 -->
        <CustomBehavior File="RunCode" Code="PrintStep(206)" />
        <!-- 207 -->
        <CustomBehavior File="RunCode" Code="PrintStep(207)" />
        <!-- 208 -->
        <CustomBehavior File="RunCode" Code="PrintStep(208)" />
        <If Condition="DoQuest(41475)" >
            <CustomBehavior File="KillUntilComplete" MobIds="104224" TerminateWhen="IsObjectiveComplete(1, 41475)" >
                <HotSpots>
                    <Hotspot X="2195.02" Y="5066.134" Z="135.6669" />
                    <Hotspot X="2244.476" Y="5010.06" Z="137.113" />
                    <Hotspot X="2236.205" Y="4900.87" Z="143.2135" />
                    <Hotspot X="2151.802" Y="4886.728" Z="154.8712" />
                </HotSpots>
            </CustomBehavior>
        </If>

        <!-- 209 -->
        <CustomBehavior File="RunCode" Code="PrintStep(209)" />
        <TurnIn Nav="Fly" QuestName="Fertilizing the Future" QuestId="41474" TurnInName="Mythandros Irongrove" TurnInId="103569" X="2347.255" Y="5091.745" Z="112.6199" />
        <TurnIn Nav="Fly" QuestName="Prongs and Fangs" QuestId="41475" TurnInName="Mythandros Irongrove" TurnInId="103569" X="2347.255" Y="5091.745" Z="112.6199" />
        <!-- <PickUp Nav="Fly" QuestName="The Final Blessing" QuestId="41478" GiverName="Mythandros Irongrove" GiverId="103569" X="2347.073" Y="5091.385" Z="112.7444" /> -->

    </QuestOrder>
</HBProfile>
