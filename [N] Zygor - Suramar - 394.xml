<HBProfile xsi:noNamespaceSchemaLocation="../Schemas/EchoSchema.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Name>[N] Zygor Suramar 394</Name>
    <MinDurability>0.3</MinDurability>
    <MinFreeBagSlots>3</MinFreeBagSlots>
    <SellGrey>true</SellGrey>
    <SellWhite>false</SellWhite>
    <SellGreen>false</SellGreen>
    <SellBlue>false</SellBlue>
    <SellPurple>false</SellPurple>
    <MailGrey>false</MailGrey>
    <MailWhite>true</MailWhite>
    <MailGreen>true</MailGreen>
    <MailBlue>true</MailBlue>
    <MailPurple>true</MailPurple>
    <TargetElites>true</TargetElites>
    <!--These aren't used often, only if there are navigation issues with the profile or areas you want the character to avoid-->
    <Blackspots>
        <Blackspot X="879.0854" Y="5259.045" Z="48.92279" Radius="2.93233" />
    </Blackspots>
    <!--These are the vendors you want the bot to go to when doing a repair or vendor run-->
    <Vendors>
    </Vendors>
    <!--These are the locations of the available mailboxes that you want your character to use-->
    <Mailboxes>
    </Mailboxes>
    <!--Setting these would make sure the character stays away from and does not attack these mobs-->
    <AvoidMobs>
        <Mob Name="Koralune Ettin" Entry="99791" />
        <Mob Name="Elfbane" Entry="99792" />
    </AvoidMobs>
    <!--Here is where the meat of the profile will take place-->
    <QuestOrder>
        <CustomBehavior File="RunCode" Type="Definition">
            <![CDATA[

                    bool DoQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (HasQuest(questId) && !IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }
                    bool NeedsQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (!HasQuest(questId) && !IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }
                    bool NeedsBreadcrumbQuest(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (IsQuestCompleted(questId)) return false;
                        }
                        return true;
                    }
                    bool QuestDone(params uint[] questIds)
                    {
                        foreach (var questId in questIds)
                        {
                            if (HasQuest(questId) && IsQuestCompleted(questId)) return true;
                        }
                        return false;
                    }

                    bool HasAncientMana( uint amount )
                    {
                        return WoWCurrency.GetCurrencyById(1155) != null && WoWCurrency.GetCurrencyById(1155).Amount >= amount;
                    }

                    uint MaxAncientMana()
                    {
                        if( WoWCurrency.GetCurrencyById(1155) != null )
                        {
                            return WoWCurrency.GetCurrencyById(1155).TotalMax;
                        }
                        return 0;
                    }

                    double DistFrom253()
                    {
                        Vector2 loc = new Vector2( Me.Location.X, Me.Location.Y);
                        Vector2 res = new Vector2( 2949.458f, 4882.862f );

                        return CalcDist( loc, res );
                    }

                    double CalcDist( Vector2 v1, Vector2 v2 )
                    {
                        double dx = v2.X - v1.X;
                        double dy =  v2.Y - v1.Y;
                        double r = Math.Pow( dx , 2) - Math.Pow( dy, 2);

                        if( r < 0 )
                            r *= -1;

                        return Math.Sqrt(  r );
                    }

                    bool ShouldCastMask()
                    {
                        return Me.IsAlive && IsInCity() && !Me.HasAura(202477);
                    }

                    void CastMask()
                    {
                        Lua.DoString("ExtraActionButton1:Click();");
                    }

                    bool IsInCity()
                    {
                        return  Me.SubZoneId == 7963 || //The Grand Promenade
                                Me.SubZoneId == 8021 || //Lunastre Estate
                                Me.SubZoneId == 8434 || //Starcaller Retreat
                                Me.SubZoneId == 8382 || //The Waning Crescent
                                Me.SubZoneId == 8383 || //Artisan's Gallery
                                Me.SubZoneId == 8395 || //Astravar Harbor
                                Me.SubZoneId == 8385 || //Evermoon Bazaar
                                Me.SubZoneId == 7970 || //Evermoon Commons
                                Me.SubZoneId == 8386 || //Shimmershade Garden
                                Me.SubZoneId == 8398 || //Terrace of Order
                                Me.MinimapZoneText == "Estate of the First Arcanist" ||
                                Me.SubZoneId == 8149 || //Twilight Vineyards
                                Me.SubZoneId == 8353 || //Concourse of Destiny
                                Me.SubZoneId == 8397 || //Terrace of Enlightenment
                                Me.SubZoneId == 8441 || //Moonbeam Causeway
                                Me.SubZoneId == 8436 || //Sunset Park
                                Me.SubZoneId == 8351 || //The Menagerie
                                Me.SubZoneId == 8379 || //The Gilded Market
                                Me.SubZoneId == 8378 || //Moonlit Landing
                                Me.SubZoneId == 8148;   //Suramar City
                    }

                    bool IsThirsty( uint friendId )
                    {
                        List<string> values = Lua.GetReturnValues("return GetFriendshipReputation(" + friendId +")");

                        if( values.Count == 0 )
                        {   
                            Logging.Write(System.Windows.Media.Colors.Red, "[Zak]: Failed to get arcane thirst");
                            return false;
                        }

                        int level = Int32.Parse( values[1]);
                        int threshold = Int32.Parse( values[7]);
                        int newlevel = level - threshold;

                        return newlevel <= 1;
                    }

                    bool IsThalyssraThirsty()
                    {
                        return IsThirsty(1860);
                    }

                    bool IsOculethThirsty()
                    {
                        return IsThirsty(1862);
                    }

                    bool IsValtroisThirsty()
                    {
                        return IsThirsty(1919);
                    }

                    void PrintStep( uint step )
                    {
                        Logging.Write(System.Windows.Media.Colors.Yellow, "[Zak]: " + step);
                    }

                    async Task SkipCutscene(int preWait = 3000, int postWait = 3000)
                    {
                // Add detection of cutscene here.
                        await Coroutine.Sleep(preWait);
                // Test and improve the working method.
                        Lua.DoString("MovieFrame:StopMovie(); CinematicFrame_CancelCinematic(); StopCinematic();");
                        await Coroutine.Sleep(postWait);
                    }
                ]]>
        </CustomBehavior>
        

        <!-- <CustomBehavior File="Hooks\Avoid" AvoidName="MaskDetectors" ObjectIds="108190" Radius="20" /> -->

        <CustomBehavior File="RunCode" Code="PrintStep(394)" />
        <If Condition="NeedsQuest(42489)">
            <MoveTo X="1134.477" Y="2869.507" Z="44.28946" />
            <CustomBehavior File="ForcedDismount" />
        </If>

        <UseMount Value="false" />

        <PickUp Nav="Fly" QuestName="Thalyssra's Drawers" QuestId="42489" GiverName="Armoire" GiverId="251032" X="1121.544" Y="3009.178" Z="6.86612" />

        <CustomBehavior File="RunCode" Code="PrintStep(395)" />
        <If Condition="DoQuest(42489) &amp;&amp; !IsObjectiveComplete(1,42489)">
            <CustomBehavior File="InteractWith" QuestId="42489" MobId="251046" NumOfTimes="1">
                <HuntingGrounds>
                    <Hotspot X="1099.294" Y="2975.288" Z="6.198305" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(396)" />
        <If Condition="DoQuest(42489) &amp;&amp; !IsObjectiveComplete(2,42489)">
            <CustomBehavior File="InteractWith" QuestId="42489" MobId="251034" NumOfTimes="1">
                <HuntingGrounds>
                    <Hotspot X="1045.421" Y="3001.41" Z="2.953944" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(397)" />
        <If Condition="DoQuest(42489) &amp;&amp; !IsObjectiveComplete(3,42489)">
            <CustomBehavior File="InteractWith" QuestId="42489" MobId="251035" NumOfTimes="1">
                <HuntingGrounds>
                    <Hotspot X="1153.447" Y="3040.209" Z="5.441119" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(398)" />
        <If Condition="DoQuest(42488)">        
            <CustomBehavior File="KillUntilComplete" MobIds="108190" TerminateWhen="GetItemCount(138392) &gt;= 3" >
                <HuntingGrounds>
                    <Hotspot X="1153.447" Y="3040.209" Z="5.441119" />
                </HuntingGrounds>
            </CustomBehavior>
            <If Condition="GetItemCount(138392) &gt;= 3">
                <CustomBehavior File="UseItem" ItemId="138392" />
            </If>
        </If>

        <UseMount Value="true" />

        <CustomBehavior File="Hooks\DoWhen" UseWhen="ShouldCastMask()" LogExecution="true" ActivityName="apply_mask" StopMovingToConductActivity="true" AllowUseWhileMounted="true">
            <CustomBehavior File="RunCode" Code="CastMask()" />
            <CustomBehavior File="WaitTimer" WaitTime="4000" />
        </CustomBehavior>


        <CustomBehavior File="RunCode" Code="PrintStep(399)" />
        <If Condition="QuestDone(42489) &amp;&amp; QuestDone(42488) &amp;&amp; IsThalyssraThirsty()">
            <If Condition="!HasAncientMana(50)">
                <CustomBehavior File="LoadProfile" ProfileName="gather\[N]-Ancient-Mana-Zinner-Zak-50" RememberProfile="true" />
            </If>
            <CustomBehavior File="InteractWith" MobId="97140" X="1724.658" Y="4614.287" Z="123.7945"  />
            <CustomBehavior File="RunMacro" Macro="/click GossipTitleButton1" />
            <CustomBehavior File="RunMacro" Macro="/click QuestFrameCompleteButton" />
            <CustomBehavior File="RunMacro" Macro="/click QuestFrameCompleteQuestButton" />
        </If>
        <TurnIn Nav="Fly" QuestName="Thalyssra's Drawers" QuestId="42489" TurnInName="First Arcanist Thalyssra" TurnInId="97140" X="1721.308" Y="4613.505" Z="123.8009" />
        <TurnIn Nav="Fly" QuestName="Thalyssra's Abode" QuestId="42488" TurnInName="First Arcanist Thalyssra" TurnInId="97140" X="1721.308" Y="4613.505" Z="123.8009" />

        <CustomBehavior File="RunCode" Code="PrintStep(400)" />
        <If Condition="NeedsQuest(40266) || NeedsQuest(40744)">
            <CustomBehavior File="InteractWith" MobId="254129" NumOfTimes="1" X="1783.168" Y="4640.48" Z="124.789" />
        </If>

        <PickUp Nav="Fly" QuestName="The Lost Advisor" QuestId="40266" GiverName="Thaedris Feathersong" GiverId="99065" X="1937.913" Y="4128.488" Z="266.2768"  />
        <PickUp Nav="Fly" QuestName="An Ancient Recipe" QuestId="40744" GiverName="Thaedris Feathersong" GiverId="99065" X="1937.913" Y="4128.488" Z="266.2768"  />

        <CustomBehavior File="RunCode" Code="PrintStep(401)" />
        <While Condition="DoQuest(40266)">
            <MoveTo X="1955.3" Y="4090.386" Z="263.6335" />
            <CustomBehavior File="InteractWith" QuestId="40266" MobId="245186" NumOfTimes="1" InteractBlacklistTimeInSeconds="1000">
                <HuntingGrounds>
                    <Hotspot X="1981.782" Y="4070.541" Z="263.5798" />
                </HuntingGrounds>
            </CustomBehavior>
        </While>

        <CustomBehavior File="RunCode" Code="PrintStep(402)" />
        <While Condition="DoQuest(40744)">
            <CustomBehavior File="KillUntilComplete" MobIds="113573, 98306" TerminateWhen="IsObjectiveComplete(1,40744)" >
                <HuntingGrounds>
                    <Hotspot X="1953.855" Y="4182.607" Z="252.0313" />
                    <Hotspot X="1972.402" Y="4074.865" Z="263.6337" />
                    <Hotspot X="1919.736" Y="3966.884" Z="265.3144" />
                </HuntingGrounds>
            </CustomBehavior>
        </While>

        <CustomBehavior File="RunCode" Code="PrintStep(403)" />
        <TurnIn Nav="Fly" QuestName="An Ancient Recipe" QuestId="40744" TurnInName="Thaedris Feathersong" TurnInId="99093" X="1824.016" Y="3929.723" Z="272.0049" />
        <TurnIn Nav="Fly" QuestName="The Lost Advisor" QuestId="40266" TurnInName="Thaedris Feathersong" TurnInId="99093" X="1824.016" Y="3929.723" Z="272.0049" />
        <PickUp Nav="Fly" QuestName="Bad Intentions" QuestId="40227" GiverName="Thaedris Feathersong" GiverId="99093" X="1824.016" Y="3929.723" Z="272.0049" />
        
        <CustomBehavior File="RunCode" Code="PrintStep(404)" />
        <If Condition="DoQuest(40227)">
            <CustomBehavior File="InteractWith" QuestId="40227" MobId="99093" NumOfTimes="1" InteractByGossipOptions="1" X="1824.016" Y="3929.723" Z="272.0049" />
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(405)" />
        <TurnIn Nav="Fly" QuestName="Bad Intentions" QuestId="40227" TurnInName="Thaedris Feathersong" TurnInId="99093" X="1824.016" Y="3929.723" Z="272.0049" />
        <PickUp Nav="Fly" QuestName="Tools of the Trade" QuestId="40300" GiverName="Thaedris Feathersong" GiverId="99093" X="1824.016" Y="3929.723" Z="272.0049" />
        
        <If Condition="DoQuest(40300)">
            <CustomBehavior File="RunCode" Code="PrintStep(406)" />
            <If Condition="!IsObjectiveComplete(1,40300)">
                <CustomBehavior File="InteractWith" QuestId="40300" MobId="245681" NumOfTimes="1" >
                    <HuntingGrounds>
                        <Hotspot X="2001.061" Y="3864.436" Z="265.7645" />
                    </HuntingGrounds>
                </CustomBehavior>
            </If>
            <CustomBehavior File="RunCode" Code="PrintStep(407)" />
            <If Condition="!IsObjectiveComplete(2,40300)">
                <CustomBehavior File="InteractWith" QuestId="40300" MobId="245682" NumOfTimes="1" >
                    <HuntingGrounds>
                        <Hotspot X="2165.194" Y="3990.482" Z="285.1466" />
                    </HuntingGrounds>
                </CustomBehavior>
            </If>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(408)" />
        <PickUp Nav="Fly" QuestName="Fragments of Memory" QuestId="40308" GiverName="Shattered Burial Urn" GiverId="245688" X="2180.171" Y="3931.131" Z="285.1753" />
    
        <If Condition="DoQuest(40300)">
            <CustomBehavior File="RunCode" Code="PrintStep(409)" />
            <If Condition="!IsObjectiveComplete(3,40300)">
                <CustomBehavior File="InteractWith" QuestId="40300" MobId="247339" NumOfTimes="1" >
                    <HuntingGrounds>
                        <Hotspot X="2260.457" Y="3765.863" Z="276.4616" />
                    </HuntingGrounds>
                </CustomBehavior>
            </If>
        </If>

        <If Condition="DoQuest(40308)">
            <CustomBehavior File="RunCode" Code="PrintStep(410)" />
            <CustomBehavior File="KillUntilComplete" MobIds="101577, 101580, 101581" TerminateWhen="IsObjectiveComplete(1,40308)" >
                <HuntingGrounds>
                    <Hotspot X="2231.044" Y="3845.981" Z="272.8451" />
                    <Hotspot X="2260.457" Y="3765.863" Z="276.4616" />
                    <Hotspot X="2293.826" Y="3800.436" Z="284.5994" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(411)" />
        <TurnIn Nav="Fly" QuestName="Tools of the Trade" QuestId="40300" TurnInName="Thaedris Feathersong" TurnInId="99483" X="2204.25" Y="4029.721" Z="266.2486" />
        <TurnIn Nav="Fly" QuestName="Fragments of Memory" QuestId="40308" TurnInName="Thaedris Feathersong" TurnInId="99483" X="2204.25" Y="4029.721" Z="266.2486" />
        <PickUp Nav="Fly" QuestName="The Last Chapter" QuestId="40306" GiverName="Thaedris Feathersong" GiverId="99483" X="2204.25" Y="4029.721" Z="266.2486" />
        <PickUp Nav="Fly" QuestName="Paying Respects" QuestId="40578" GiverName="Thaedris Feathersong" GiverId="99483" X="2204.25" Y="4029.721" Z="266.2486" />

        <CustomBehavior File="RunCode" Code="PrintStep(412)" />
        <While Condition="DoQuest(40306)">
            <CustomBehavior File="InteractWith" QuestId="40306" MobId="245236" NumOfTimes="1" >
                <HuntingGrounds>
                    <Hotspot X="2252.697" Y="4214.764" Z="274.1958" />
                </HuntingGrounds>
            </CustomBehavior>
        </While>

        <If Condition="DoQuest(40578)">
            <CustomBehavior File="RunCode" Code="PrintStep(413)" />
            <CustomBehavior File="KillUntilComplete" MobIds="97732, 97729" TerminateWhen="IsObjectiveComplete(1,40578)" >
                <HuntingGrounds>
                    <Hotspot X="2228.927" Y="4200.428" Z="259.7561" />
                    <Hotspot X="2141.745" Y="4146.204" Z="254.2535" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(414)" />
        <TurnIn Nav="Fly" QuestName="The Last Chapter" QuestId="40306" TurnInName="Thaedris Feathersong" TurnInId="99575" X="2305.626" Y="4155.99" Z="295.1306"  />
        <TurnIn Nav="Fly" QuestName="Paying Respects" QuestId="40578" TurnInName="Thaedris Feathersong" TurnInId="99575" X="2305.626" Y="4155.99" Z="295.1306"  />

        <If Condition="NeedsQuest(40315)">
            <CustomBehavior File="InteractWith" MobId="99575" NumOfTimes="1" X="1824.016" Y="3929.723" Z="272.0049" />
            <CustomBehavior File="RunMacro" Macro="/run AcceptQuest()" />
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(415)" />
        <If Condition="DoQuest(40315)">
            <CustomBehavior File="InteractWith" QuestId="40315" MobId="99575" NumOfTimes="1" InteractByGossipOptions="1" X="1824.016" Y="3929.723" Z="272.0049" />
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(416)" />
        <TurnIn Nav="Fly" QuestName="End of the Line" QuestId="40315" TurnInName="Thaedris Feathersong" TurnInId="99575" X="1824.016" Y="3929.723" Z="272.0049" />
        <PickUp Nav="Fly" QuestName="The Final Ingredient" QuestId="40319" GiverName="Thaedris Feathersong" GiverId="99575" X="1824.016" Y="3929.723" Z="272.0049" />
    
        <CustomBehavior File="RunCode" Code="PrintStep(417)" />
        <If Condition="DoQuest(40319)">
            <CustomBehavior File="KillUntilComplete" MobIds="97750" TerminateWhen="IsObjectiveComplete(1,40319)" >
                <HuntingGrounds>
                    <Hotspot X="2331.418" Y="4029.525" Z="294.5592" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(418)" />
        <TurnIn Nav="Fly" QuestName="The Final Ingredient" QuestId="40319" TurnInName="Thaedris Feathersong" TurnInId="99575" X="1824.016" Y="3929.723" Z="272.0049" />
        <PickUp Nav="Fly" QuestName="Feathersong's Redemption" QuestId="40321" GiverName="Thaedris Feathersong" GiverId="99575" X="1824.016" Y="3929.723" Z="272.0049" />

        <CustomBehavior File="RunCode" Code="PrintStep(419)" />
        <If Condition="DoQuest(40321)">
          <CustomBehavior File="CombatUseItemOnV2" QuestId="40321" ItemId="130260" ItemAppliesAuraId="AssumeItemUseAlwaysSucceeds" MobId="99593"
          UseWhenMobHasHealthPercent="100" MaxRangeToUseItem="15" UseItemStrategy="UseItemOncePerTarget"
          RecallPetAtMobPercentHealth="0" >
              <HuntingGrounds >
                <Hotspot X="2589.755" Y="4169.936" Z="340.3653" />
              </HuntingGrounds>
          </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(420)" />
        <TurnIn Nav="Fly" QuestName="Feathersong's Redemption" QuestId="40321" TurnInName="Thaedris Feathersong" TurnInId="100779" X="2567.609" Y="4161.703" Z="336.2392" />

        <CustomBehavior File="RunCode" Code="PrintStep(421)" />
        <PickUp Nav="Fly" QuestName="Lyana Darksorrow" QuestId="40297" GiverName="Lyana Darksorrow" GiverId="98801" X="1255.429" Y="4946.362" Z="69.86123" />

        <CustomBehavior File="RunCode" Code="PrintStep(422)" />
        <If Condition="DoQuest(40297)">
            <CustomBehavior File="InteractWith" QuestId="40297" MobId="99470" NumOfTimes="1" X="1255.996" Y="4948.305" Z="69.17934" />
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(423)" />
        <TurnIn Nav="Fly" QuestName="Lyana Darksorrow" QuestId="40297" TurnInName="Lyana Darksorrow" TurnInId="99514" X="1255.996" Y="4948.305" Z="69.17934" />
        <PickUp Nav="Fly" QuestName="Glaive Circumstances" QuestId="40307" GiverName="Lyana Darksorrow" GiverId="99514" X="1255.996" Y="4948.305" Z="69.17934" />
        <PickUp Nav="Fly" QuestName="Fresh Meat" QuestId="40898" GiverName="Lyana Darksorrow" GiverId="99514" X="1255.996" Y="4948.305" Z="69.17934" />

        <CustomBehavior File="RunCode" Code="PrintStep(424)" />
        <If Condition="DoQuest(40307)">

            <UseMount Value="false" />
            
            <If Condition="!IsObjectiveComplete(2,40307)">
                <CustomBehavior File="InteractWith" QuestId="40307" MobId="245245" NumOfTimes="1" X="1225.726" Y="5148.667" Z="56.89205" />
            </If>

            <UseMount Value="true" />

            <CustomBehavior File="RunCode" Code="PrintStep(425)" />
            <If Condition="!IsObjectiveComplete(1,40307)">
                <!-- <CustomBehavior File="MyCTM" X="1189.306" Y="5142.74" Z="55.93295" /> -->
                <CustomBehavior File="KillUntilComplete" MobIds="100595" TerminateWhen="IsObjectiveComplete(1,40307)" >
                    <HuntingGrounds>
                        <Hotspot X="1057.823" Y="5288.306" Z="75.05817" />
                    </HuntingGrounds>
                </CustomBehavior>
            </If>

        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(426)" />
        <If Condition="!IsObjectiveComplete(1,40898)">
            <!-- <CustomBehavior File="MyCTM" X="1189.306" Y="5142.74" Z="55.93295" /> -->
            <CustomBehavior File="KillUntilComplete" MobIds="101868" TerminateWhen="IsObjectiveComplete(1,40898)" >
                <HuntingGrounds>
                    <Hotspot X="1163.796" Y="5195.795" Z="78.11154" />
                    <Hotspot X="1141.654" Y="5076.333" Z="58.12973" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(427)" />
        <TurnIn Nav="Fly" QuestName="Glaive Circumstances" QuestId="40307" TurnInName="Lyana Darksorrow" TurnInId="99514" X="1255.996" Y="4948.305" Z="69.17934" />
        <TurnIn Nav="Fly" QuestName="Fresh Meat" QuestId="40898" TurnInName="Lyana Darksorrow" TurnInId="99514" X="1255.996" Y="4948.305" Z="69.17934" />
        <PickUp Nav="Fly" QuestName="Grimwing the Devourer" QuestId="40901" GiverName="Lyana Darksorrow" GiverId="99514" X="1255.996" Y="4948.305" Z="69.17934" />
        
        <CustomBehavior File="RunCode" Code="PrintStep(428)" />
        <If Condition="DoQuest(40901)">
            <MoveTo X="1273.912" Y="5231.249" Z="93.53309" />
            <CustomBehavior File="UseItem" ItemId="133756" />
            <CustomBehavior File="KillUntilComplete" MobIds="102292" TerminateWhen="IsObjectiveComplete(1,40901)" >
                <HuntingGrounds>
                    <Hotspot X="1273.912" Y="5231.249" Z="93.53309" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(429)" />
        <TurnIn Nav="Fly" QuestName="Grimwing the Devourer" QuestId="40901" TurnInName="Lyana Darksorrow" TurnInId="99890" X="879.246" Y="4990.934" Z="25.92789"  />
        <PickUp Nav="Fly" QuestName="A Fate Worse Than Dying" QuestId="40328" GiverName="Lyana Darksorrow" GiverId="99890" X="879.246" Y="4990.934" Z="25.92789"/>
        <PickUp Nav="Fly" QuestName="Symbols of Power" QuestId="40929" GiverName="Lyana Darksorrow" GiverId="99890" X="879.246" Y="4990.934" Z="25.92789" />

        
        <UseMount Value="false" />
        <CustomBehavior File="ForcedDismount" />

        <CustomBehavior File="RunCode" Code="PrintStep(430)" />
        <While Condition="DoQuest(40328)">
            <MoveTo X="907.4639" Y="4713.876" Z="43.51472" />
            <CustomBehavior File="WaitTimer" WaitTime="1000" />
            <CustomBehavior File="InteractWith" QuestId="40328" MobId="246568" NumOfTimes="1" CollectionDistance="21.0" Range="21.0" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="907.4639" Y="4713.876" Z="43.51472" />

            <MoveTo X="956.3354" Y="4699.007" Z="43.90011"  />
            <CustomBehavior File="WaitTimer" WaitTime="1000" />
            <CustomBehavior File="InteractWith" QuestId="40328" MobId="246568" NumOfTimes="1" CollectionDistance="21.0" Range="21.0" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="956.3354" Y="4699.007" Z="43.90011"  />

            <MoveTo X="919.2921" Y="4649.644" Z="38.64106"  />
            <CustomBehavior File="WaitTimer" WaitTime="1000" />
            <CustomBehavior File="InteractWith" QuestId="40328" MobId="246568" NumOfTimes="1" CollectionDistance="21.0" Range="21.0" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="919.2921" Y="4649.644" Z="38.64106"  />

            <MoveTo X="1006.53" Y="4739.956" Z="39.0179" />
            <CustomBehavior File="WaitTimer" WaitTime="1000" />
            <CustomBehavior File="InteractWith" QuestId="40328" MobId="246568" NumOfTimes="1" CollectionDistance="21.0" Range="21.0" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="1006.53" Y="4739.956" Z="39.0179"   />

            <MoveTo X="900.4448" Y="4754.698" Z="41.06585" />
            <CustomBehavior File="WaitTimer" WaitTime="1000" />
            <CustomBehavior File="InteractWith" QuestId="40328" MobId="246568" NumOfTimes="1" CollectionDistance="21.0" Range="21.0" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="900.4448" Y="4754.698" Z="41.06585" />

            <MoveTo X="933.193" Y="4766.787" Z="66.32096" />
            <CustomBehavior File="WaitTimer" WaitTime="1000" />
            <CustomBehavior File="InteractWith" QuestId="40328" MobId="246568" NumOfTimes="1" CollectionDistance="21.0" Range="21.0" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="933.193" Y="4766.787" Z="66.32096"  />

            <MoveTo X="957.9017" Y="4763.552" Z="66.29777" />
            <CustomBehavior File="WaitTimer" WaitTime="1000" />
            <CustomBehavior File="InteractWith" QuestId="40328" MobId="246568" NumOfTimes="1" CollectionDistance="21.0" Range="21.0" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="957.9017" Y="4763.552" Z="66.29777" />

            <MoveTo X="894.1814" Y="4730.729" Z="67.04298"   />
            <CustomBehavior File="WaitTimer" WaitTime="1000" />
            <CustomBehavior File="InteractWith" QuestId="40328" MobId="246568" NumOfTimes="1" CollectionDistance="19.0" Range="19.0" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="894.1814" Y="4730.729" Z="67.04298"     />

            <MoveTo X="893.9567" Y="4693.953" Z="66.92442"   />
            <CustomBehavior File="WaitTimer" WaitTime="1000" />
            <CustomBehavior File="InteractWith" QuestId="40328" MobId="246568" NumOfTimes="1" CollectionDistance="19.0" Range="19.0" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="893.9567" Y="4693.953" Z="66.92442" />
        </While>

        <CustomBehavior File="RunCode" Code="PrintStep(431)" />
        <While Condition="DoQuest(40929)">
            <CustomBehavior File="KillUntilComplete" MobIds="99762,101878,106339,102898,110805" TerminateWhen="IsObjectiveComplete(1,40929)" >
                <HuntingGrounds>
                    <Hotspot X="894.2945" Y="4713.803" Z="66.02782"  />
                </HuntingGrounds>
            </CustomBehavior>
        </While>

        <UseMount Value="true" />

        <CustomBehavior File="RunCode" Code="PrintStep(432)" />
        <TurnIn Nav="Fly" QuestName="Symbols of Power" QuestId="40929" TurnInName="Lyana Darksorrow" TurnInId="99890" X="879.246" Y="4990.934" Z="25.92789" />
        <TurnIn Nav="Fly" QuestName="A Fate Worse Than Dying" QuestId="40328" TurnInName="Lyana Darksorrow" TurnInId="99890" X="879.246" Y="4990.934" Z="25.92789" />
        <PickUp Nav="Fly" QuestName="Shard of Vorgos" QuestId="41097" GiverName="Lyana Darksorrow" GiverId="99890" X="879.246" Y="4990.934" Z="25.92789" />
        <PickUp Nav="Fly" QuestName="Shard of Kozak" QuestId="41098" GiverName="Lyana Darksorrow" GiverId="99890" X="879.246" Y="4990.934" Z="25.92789" />

        <CustomBehavior File="RunCode" Code="PrintStep(433)" />
        <PickUp Nav="Fly" QuestName="The Key Is Around Here Somewhere..." QuestId="41139" GiverName="Angus Stormbrew" GiverId="103204" X="387.9645" Y="5079.631" Z="-87.42442"  />

        <CustomBehavior File="RunCode" Code="PrintStep(434)" />
        <If Condition="DoQuest(41139)">
            <CustomBehavior File="InteractWith" QuestId="41139" MobId="247063" NumOfTimes="500" ProactiveCombatStrategy="ClearMobsThatWillAggro" >
                <HuntingGrounds>
                    <Hotspot X="386.083" Y="5078.913" Z="-87.1555" />
                    <Hotspot X="407.3662" Y="5030.951" Z="-88.56811" />
                    <Hotspot X="459.8196" Y="5037.458" Z="-89.20588" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(435)" />
        <TurnIn Nav="Fly" QuestName="The Key Is Around Here Somewhere..." QuestId="41139" TurnInName="Angus Stormbrew" TurnInId="103204" X="387.9645" Y="5079.631" Z="-87.42442"  />
        <PickUp Nav="Fly" QuestName="Search and Rescue!" QuestId="41140" GiverName="Angus Stormbrew" GiverId="103204" X="387.9645" Y="5079.631" Z="-87.42442" />
    
        <CustomBehavior File="RunCode" Code="PrintStep(436)" />
        <If Condition="DoQuest(41140)">
            <CustomBehavior File="InteractWith" QuestId="41140" QuestObjectiveIndex="1" MobId="247062" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="387.9645" Y="5079.631" Z="-87.42442" />
            <CustomBehavior File="RunCode" Code="PrintStep(438)" />
            <CustomBehavior File="InteractWith" QuestId="41140" QuestObjectiveIndex="3" MobId="247291" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="259.7566" Y="5147.722" Z="-86.47305" />
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(439)" />
        <PickUp Nav="Fly" QuestName="Leyline Feed: Halls of the Eclipse" QuestId="43594" GiverName="Leyline Feed" GiverId="252264" X="249.9548" Y="5145.342" Z="-86.97169" />

        <CustomBehavior File="RunCode" Code="PrintStep(440)" />
        <If Condition="DoQuest(43594)  &amp;&amp; !HasAncientMana(250)">
            <CustomBehavior File="LoadProfile" ProfileName="gather\[N]-Ancient-Mana-Zinner-Zak-300" RememberProfile="true" />
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(441)" />
        <TurnIn Nav="Fly" QuestName="Leyline Feed: Halls of the Eclipse" QuestId="43594" TurnInName="Leyline Feed" TurnInId="252264" X="249.9548" Y="5145.342" Z="-86.97169" />

        <CustomBehavior File="RunCode" Code="PrintStep(442)" />
        <If Condition="DoQuest(41098)">
            <CustomBehavior File="KillUntilComplete" MobIds="99485" TerminateWhen="IsObjectiveComplete(1,41098)" >
                <HuntingGrounds>
                    <Hotspot X="259.7926" Y="5180.165" Z="-86.48199" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(443)" />
        <If Condition="DoQuest(41140)">
            <CustomBehavior File="InteractWith" QuestId="41140" QuestObjectiveIndex="4" MobId="247398" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="154.2228" Y="5132.499" Z="-116.4004" />
            <CustomBehavior File="RunCode" Code="PrintStep(444)" />
            <CustomBehavior File="InteractWith" QuestId="41140" QuestObjectiveIndex="5" MobId="247292" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="255.1553" Y="5152.27" Z="-86.57502" />
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(445)" />
        <TurnIn Nav="Fly" QuestName="Search and Rescue!" QuestId="41140" TurnInName="Selthaes Starsong" TurnInId="102365" X="255.1553" Y="5152.27" Z="-86.57502" />

        <CustomBehavior File="RunCode" Code="PrintStep(446)" />
        <PickUp Nav="Fly" QuestName="Into The Pit!" QuestId="41222" GiverName="Angus Stormbrew" GiverId="103437" />

        <CustomBehavior File="RunCode" Code="PrintStep(447)" />
        <TurnIn Nav="Fly" QuestName="Shard of Kozak" QuestId="41098" TurnInName="Portal Activation Altar" TurnInId="246885" X="294.8321" Y="4925.355" Z="-83.89065" />

        <CustomBehavior File="RunCode" Code="PrintStep(448)" />
        <If Condition="DoQuest(41097)">
            <CustomBehavior File="KillUntilComplete" MobIds="103089" TerminateWhen="IsObjectiveComplete(1,41097)" >
                <HuntingGrounds>
                    <Hotspot X="681.1089" Y="4498.025" Z="-120.2052" />
                </HuntingGrounds>
            </CustomBehavior>
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(449)" />
        <TurnIn Nav="Fly" QuestName="Shard of Vorgos" QuestId="41097" TurnInName="Portal Activation Altar" TurnInId="246884" X="294.8321" Y="4925.355" Z="-83.89065"/>

        <CustomBehavior File="RunCode" Code="PrintStep(450)" />
        <PickUp Nav="Fly" QuestName="Azoran Must Die" QuestId="40412" GiverName="Lyana Darksorrow" GiverId="100823" X="294.8321" Y="4925.355" Z="-83.89065"/>
    

        <CustomBehavior File="RunCode" Code="PrintStep(451)" />
        <If Condition="DoQuest(40412) &amp;&amp; !IsObjectiveComplete(1,40412)">
            <If Condition="Me.MinimapZoneText == &quot;Felsoul Command&quot;">
                <CustomBehavior File="InteractWith" QuestId="40412" MobId="247027" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="302.2647" Y="4935.062" Z="-83.89333" />
            </If>

            <CustomBehavior File="RunCode" Code="PrintStep(452)" />
            <CustomBehavior File="KillUntilComplete" MobIds="100019" TerminateWhen="IsObjectiveComplete(1,40412)" >
                <HuntingGrounds>
                    <Hotspot X="707.5012" Y="4824.322" Z="-65.15475" />
                </HuntingGrounds>
            </CustomBehavior>
            
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(453)" />
        <If Condition="QuestDone(40412) &amp;&amp; Me.MinimapZoneText == &quot;The Lightbreaker&quot;">
            <CustomBehavior File="InteractWith" MobId="247029" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="665.0742" Y="4827.471" Z="-89.9126"  />
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(454)" />
        <TurnIn Nav="Fly" QuestName="Azoran Must Die" QuestId="40412" TurnInName="Lyana Darksorrow" TurnInId="100878" />
        
        <CustomBehavior File="RunCode" Code="PrintStep(455)" />
        <If Condition="DoQuest(41222)">
            <MoveTo X="710.5515" Y="4746.496" Z="-193.784" />        
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(456)" />
        <TurnIn Nav="Fly" QuestName="Into The Pit!" QuestId="41222" TurnInName="Angus Stormbrew" TurnInId="103437" X="710.5515" Y="4746.496" Z="-193.784" />
        <PickUp Nav="Fly" QuestName="Parts Unknown" QuestId="41214" GiverName="Angus Stormbrew" GiverId="103437" X="710.5515" Y="4746.496" Z="-193.784" />

        <CustomBehavior File="RunCode" Code="PrintStep(457)" />
        <If Condition="DoQuest(41214)">
            <CustomBehavior File="InteractWith" MobId="247389" QuestId="41214" QuestObjectiveIndex="1" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="708.1723" Y="4751.759" Z="-194.0068" />
            
            <CustomBehavior File="RunCode" Code="PrintStep(458)" />
            <CustomBehavior File="InteractWith" MobId="247393" QuestId="41214" QuestObjectiveIndex="2" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="714.3679" Y="4707.842" Z="-203.0887" />
            
            <CustomBehavior File="RunCode" Code="PrintStep(459)" />
            <CustomBehavior File="InteractWith" MobId="247394" QuestId="41214" QuestObjectiveIndex="3" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="763.2656" Y="4674.016" Z="-210.7676" />

            <CustomBehavior File="RunCode" Code="PrintStep(460)" />
            <CustomBehavior File="InteractWith" MobId="247395" QuestId="41214" QuestObjectiveIndex="4" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="767.9184" Y="4593.873" Z="-202.6894"  />

            <CustomBehavior File="RunCode" Code="PrintStep(461)" />
            <!-- there is a hill that moveto has a problem with here -->
            <If Condition="!IsObjectiveComplete(5,41214)">
                <CustomBehavior File="MyCTM" X="759.5448" Y="4605.535" Z="-202.6931" />
                <CustomBehavior File="MyCTM" X="804.5924" Y="4633.766" Z="-194.3151" />
            </If>
            <CustomBehavior File="InteractWith" MobId="247392" QuestId="41214" QuestObjectiveIndex="5" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="804.5924" Y="4633.766" Z="-194.3151"  />

            <CustomBehavior File="RunCode" Code="PrintStep(462)" />
            <CustomBehavior File="InteractWith" MobId="247390" QuestId="41214" QuestObjectiveIndex="6" NumOfTimes="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="826.684" Y="4672.645" Z="-179.3425" />
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(463)" />
        <TurnIn Nav="Fly" QuestName="Parts Unknown" QuestId="41214" TurnInName="Angus Stormbrew" TurnInId="103437" X="824.0563" Y="4668.925" Z="-180.2363" />
        <PickUp Nav="Fly" QuestName="Mangelrath" QuestId="41309" GiverName="Angus Stormbrew" GiverId="103437" X="824.0563" Y="4668.925" Z="-180.2363" />
<!-- <TurnIn Nav="Fly" QuestName="Mangelrath" QuestId="41309" TurnInName="Brambley Morrison" TurnInId="104161" /> -->
    
        <CustomBehavior File="RunCode" Code="PrintStep(464)" />
        <If Condition="DoQuest(41309)">
            <CustomBehavior File="KillUntilComplete" MobIds="103671" TerminateWhen="IsObjectiveComplete(1,41309)" >
                <HuntingGrounds>
                    <Hotspot X="824.0563" Y="4668.925" Z="-180.2363" />
                </HuntingGrounds>
            </CustomBehavior>

            <CustomBehavior File="RunCode" Code="PrintStep(465)" />
            <CustomBehavior File="InteractWith" MobId="103852" QuestId="41309" QuestObjectiveIndex="2" NumOfTimes="1" InteractByGossipOptions="1" ProactiveCombatStrategy="ClearMobsThatWillAggro" X="823.6934" Y="4702.49" Z="-179.0435"   />
        </If>

        <CustomBehavior File="RunCode" Code="PrintStep(467)" />
        <If Condition="QuestDone(41309) &amp;&amp; Me.MinimapZoneText == &quot;Felmaw Cavern&quot;">
            <CustomBehavior File="MyCTM" X="761.6248" Y="4670.727" Z="-210.7676" />
        </If>
        <TurnIn Nav="Fly" QuestName="Mangelrath" QuestId="41309" TurnInName="Brambley Morrison" TurnInId="104161" X="761.6248" Y="4670.727" Z="-210.7676"  />

        <CustomBehavior File="RunCode" Code="PrintStep(468)" />
        <!-- HONORED NOW REQUIRED -->

    </QuestOrder>
</HBProfile>
